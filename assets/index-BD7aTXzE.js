(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&t(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const L=document.getElementById("theme-toggle");if(!L)throw new Error("Theme toggle button not found");localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark");function N(){document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}L.addEventListener("click",N);var i=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(i||{}),d=(e=>(e.Row="row",e.Col="col",e))(d||{});const c=5,A="/tangled",b=()=>({misplaced:new Set,absent:new Set}),I=()=>({mode:d.Row,cursor:{row:0,col:0},grid:Array.from({length:c},()=>Array.from({length:c},()=>({letter:"",state:i.Empty}))),knowledge:{row:Array.from({length:c},b),col:Array.from({length:c},b)}}),y=I();let z=[],P=0;const B=()=>fetch(`${A}/puzzles.txt`).then(e=>e.text()).then(e=>{z=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(r=>r.toUpperCase().split("")))}),v=()=>z[P]??[];let x=new Set;const O=()=>fetch(`${A}/guesses.txt`).then(e=>e.text()).then(e=>{x=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),X=e=>x.has(e),M=document.getElementById("board"),Y=()=>{const e=[];for(let o=0;o<c;o++){const r=[];for(let t=0;t<c;t++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(o+2),n.style.gridColumn=String(t+2),M.appendChild(n),r.push(n)}e.push(r)}return e},k=e=>Array.from({length:c},(o,r)=>{const t=document.createElement("div");return t.className=`knowledge ${e.className}`,t.style.gridRow=e.gridRow(r),t.style.gridColumn=e.gridColumn(r),M.appendChild(t),t}),u=Y(),K=k({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),$=k({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),U=k({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),G=k({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),p=(e,o,r,t)=>{e.forEach((n,s)=>{n.replaceChildren(),[...o[s][r]].sort().forEach(l=>{const a=document.createElement("div");a.className=`knowledge-cell ${t}`,a.textContent=l,n.appendChild(a)})})},H=e=>{for(let o=0;o<c;o++)for(let r=0;r<c;r++){const t=u[o][r],n=e.grid[o][r];t.className="cell",t.textContent=n.letter??"",t.classList.add(n.state)}},T=e=>{const{mode:o,cursor:r}=e;(o===d.Row?u[r.row]:u.map(n=>n[r.col])).forEach(n=>n.classList.add("highlight")),u[r.row][r.col].classList.add("cursor")},h=e=>{H(e),T(e),p(K,e.knowledge.row,"misplaced","misplaced-row"),p($,e.knowledge.row,"absent","absent"),p(U,e.knowledge.col,"misplaced","misplaced-col"),p(G,e.knowledge.col,"absent","absent")},E=(e,o,r,t)=>({row:e===d.Row?o:t,col:e===d.Row?t:r}),W=(e,o,r,t)=>{e.knowledge.row[o].misplaced.delete(t),e.knowledge.row[o].absent.delete(t),e.knowledge.col[r].misplaced.delete(t),e.knowledge.col[r].absent.delete(t)},D=(e,o,r,t)=>{const n=v(),s=n[r].some((l,a)=>l===o.letter&&e.grid[r][a].state!==i.Correct),m=n.some((l,a)=>l[t]===o.letter&&e.grid[a][t].state!==i.Correct);s&&m?(o.state=i.MisplacedBoth,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].misplaced.add(o.letter)):s?(o.state=i.MisplacedRow,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].absent.add(o.letter)):m?(o.state=i.MisplacedCol,e.knowledge.col[t].misplaced.add(o.letter),e.knowledge.row[r].absent.add(o.letter)):(o.state=i.Absent,e.knowledge.row[r].absent.add(o.letter),e.knowledge.col[t].absent.add(o.letter))},Z=e=>{const{mode:o,grid:r,cursor:t}=e,n=o===d.Row?r[t.row]:r.map(l=>l[t.col]),s=n.map(l=>l.letter).join("");if(s.length<c)return{success:!1,error:"incomplete"};if(!X(s))return{success:!1,error:"invalid"};const m=v();return n.forEach((l,a)=>{const{row:w,col:g}=E(o,t.row,t.col,a),S=o===d.Row?m[t.row][a]:m[a][t.col];l.letter===S&&(l.state=i.Correct),e.knowledge.col[g].misplaced.delete(l.letter),e.knowledge.row[w].misplaced.delete(l.letter)}),n.forEach((l,a)=>{if(l.state===i.Correct)return;const{row:w,col:g}=E(o,t.row,t.col,a);W(e,w,g,l.letter),D(e,l,w,g)}),{success:!0}},_=e=>e.mode===d.Row?u[e.cursor.row]:u.map(o=>o[e.cursor.col]),j=e=>{const o=_(e),t=e.mode===d.Row?[{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(-4px)"},{transform:"translateX(4px)"},{transform:"translateX(0)"}]:[{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(6px)"},{transform:"translateY(-4px)"},{transform:"translateY(4px)"},{transform:"translateY(0)"}];o.forEach(n=>{n.animate(t,{duration:400,easing:"ease-in-out"})})},C=e=>{e.mode=e.mode===d.Row?d.Col:d.Row},f=(e,o)=>{const r=o==="down"||o==="right"?1:c-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+r)%c:e.cursor.col=(e.cursor.col+r)%c},q=e=>{const{row:o,col:r}=e.cursor;e.grid[o][r].state!==i.Correct&&(e.grid[o][r]={letter:"",state:i.Empty}),e.mode===d.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},F=(e,o)=>{const{row:r,col:t}=e.cursor,n=e.grid[r][t];n.state!==i.Correct&&(n.letter=o.toUpperCase(),e.mode===d.Row?e.cursor.col=Math.min(c-1,e.cursor.col+1):e.cursor.row=Math.min(c-1,e.cursor.row+1))},R=(e,o,r)=>{e.cursor.row=o,e.cursor.col=r},V=e=>{window.addEventListener("keydown",o=>{switch(o.key){case" ":o.preventDefault(),C(e);break;case"ArrowUp":f(e,"up");break;case"ArrowDown":f(e,"down");break;case"ArrowLeft":f(e,"left");break;case"ArrowRight":f(e,"right");break;case"Backspace":q(e);break;case"Enter":{const r=Z(e);!r.success&&r.error==="invalid"&&j(e);break}default:/^[a-zA-Z]$/.test(o.key)&&F(e,o.key)}h(e)}),u.forEach((o,r)=>{o.forEach((t,n)=>{t.addEventListener("click",()=>{R(e,r,n),h(e)}),t.addEventListener("dblclick",()=>{R(e,r,n),C(e),h(e)})})})};Promise.all([O(),B()]).then(()=>{console.log("Game data loaded"),V(y),h(y)});
