(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const me=document.getElementById("theme-toggle");if(!me)throw new Error("Theme toggle button not found");const N=document.getElementById("logo"),Te={correct:"--cell-correct","misplaced-both":"--cell-misplaced-both","misplaced-row":"--cell-misplaced-row","misplaced-col":"--cell-misplaced-col"};if(N){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],t=e[Math.floor(Math.random()*e.length)];N.classList.add(t);const o=Te[t];document.documentElement.style.setProperty("--primary-color",`var(${o})`)}function ue(){N&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle(N),t=getComputedStyle(document.documentElement),o=e.backgroundColor,n=t.getPropertyValue("--text-color").trim(),r=t.getPropertyValue("--cell-border").trim(),s=document.createElement("canvas");s.width=64,s.height=64;const l=s.getContext("2d");if(l){l.fillStyle=r,l.fillRect(0,0,64,64);const c=4;l.fillStyle=o,l.fillRect(c,c,64-c*2,64-c*2),l.fillStyle=n,l.font="bold 40px system-ui, sans-serif",l.textAlign="center",l.textBaseline="middle",l.fillText("T",32,34);let a=document.querySelector("link[rel='icon']");a||(a=document.createElement("link"),a.rel="icon",document.head.appendChild(a)),a.href=s.toDataURL("image/png")}})})}ue();function xe(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),ue()}me.addEventListener("click",xe);const _e=document.getElementById("help-btn"),y=document.getElementById("help-modal"),De=y?.querySelector(".modal-close"),Oe=y?.querySelector(".modal-backdrop");function pe(){y?.removeAttribute("hidden")}function $(){y?.setAttribute("hidden","")}_e?.addEventListener("click",pe);De?.addEventListener("click",$);Oe?.addEventListener("click",$);document.addEventListener("keydown",e=>{e.key==="Escape"&&y&&(y.hasAttribute("hidden")?pe():$())});var i=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(i||{}),m=(e=>(e.Row="row",e.Col="col",e))(m||{});const u=5,G="/tangled",X=()=>({misplaced:new Set,absent:new Set}),ge=()=>({mode:m.Row,cursor:{row:0,col:0},grid:Array.from({length:u},()=>Array.from({length:u},()=>({letter:"",state:i.Empty}))),knowledge:{row:Array.from({length:u},X),col:Array.from({length:u},X)},tries:{row:Array.from({length:u},()=>0),col:Array.from({length:u},()=>0)}}),b=ge(),U=e=>{const t=ge();e.mode=t.mode,e.cursor=t.cursor,e.grid=t.grid,e.knowledge=t.knowledge,e.tries=t.tries},fe=[{code:"en",name:"English",nativeName:"English"},{code:"fr",name:"French",nativeName:"Français"},{code:"pt",name:"Portuguese",nativeName:"Português"}];let he="en",we={};const k=()=>he,Ee=e=>{he=e},Ce=async e=>{we=await(await fetch(`${G}/locales/${e}.json`)).json()},x=e=>{const t=e.split(".");let o=we;for(const n of t)if(o&&typeof o=="object"&&n in o)o=o[n];else return e;return typeof o=="string"?o:e},$e=()=>{const e=navigator.language.split("-")[0],t=fe.find(o=>o.code===e);return t?t.code:"en"};let B=[],Y=1;const be=e=>{const t=e??k();return fetch(`${G}/puzzles/${t}.txt`).then(o=>o.text()).then(o=>{B=o.split(`
`).map(n=>n.trim()).filter(n=>n.length>0).map(n=>n.split(/\s+/).map(r=>r.toUpperCase().split("")))})},ye=()=>B[Y]??[],H=e=>{e>=0&&e<B.length&&(Y=e)},Q=()=>Y,Ae=()=>B.length;let Le=new Set;const ze=e=>{const t=e??k();return fetch(`${G}/words/${t}.txt`).then(o=>o.text()).then(o=>{Le=new Set(o.split(`
`).map(n=>n.trim().toUpperCase()))})},Ge=e=>Le.has(e),Ue=e=>Promise.all([be(e),ze(e)]).then(()=>{}),K=document.getElementById("board"),Ye=document.getElementById("keyboard"),He=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const t=document.createElement("div");t.className="tries-label",t.textContent="TRIES",t.dataset.i18n="game.tries";const o=document.createElement("div");return o.className="tries-count",o.textContent="0",e.appendChild(t),e.appendChild(o),K.appendChild(e),{container:e,count:o}},Ke=He(),Ze=Ke.count,Fe=()=>{const e=[];for(let t=0;t<u;t++){const o=[];for(let n=0;n<u;n++){const r=document.createElement("div");r.className="cell",r.style.gridRow=String(t+2),r.style.gridColumn=String(n+2),K.appendChild(r),o.push(r)}e.push(o)}return e},T=e=>Array.from({length:u},(t,o)=>{const n=document.createElement("div");return n.className=`knowledge ${e.className}`,n.style.gridRow=e.gridRow(o),n.style.gridColumn=e.gridColumn(o),K.appendChild(n),n}),g=Fe(),Ve=T({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),qe=T({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),We=T({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),je=T({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),Je=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],Xe=()=>{const e=new Map;return Je.forEach(t=>{const o=document.createElement("div");o.className="keyboard-row",t.forEach(n=>{const r=document.createElement("button");r.className="keyboard-key",r.dataset.key=n,n==="ENTER"?(r.textContent="ENTER",r.dataset.i18n="keyboard.enter",r.classList.add("wide")):n==="⌫"?(r.textContent="⌫",r.classList.add("wide")):r.textContent=n,e.set(n,r),o.appendChild(r)}),Ye.appendChild(o)}),e},Se=Xe(),v=(e,t,o,n)=>{e.forEach((r,s)=>{r.replaceChildren(),[...t[s][o]].sort().forEach(c=>{const a=document.createElement("div");a.className=`knowledge-cell ${n}`,a.textContent=c,r.appendChild(a)})})},Qe=e=>{for(let t=0;t<u;t++)for(let o=0;o<u;o++){const n=g[t][o],r=e.grid[t][o];n.className="cell",n.textContent=r.letter??"",n.classList.add(r.state)}},et=e=>{const{mode:t,cursor:o}=e;(t===m.Row?g[o.row]:g.map(r=>r[o.col])).forEach(r=>r.classList.add("highlight")),g[o.row][o.col].classList.add("cursor")},tt=["correct","misplaced-row","misplaced-col","absent"],ot=e=>{const t=e.tries.row.reduce((o,n)=>o+n,0)+e.tries.col.reduce((o,n)=>o+n,0);Ze.textContent=String(t)},nt=e=>{const{mode:t,cursor:o}=e,n=t===m.Row?o.row:o.col,r=t===m.Row?e.knowledge.row[n]:e.knowledge.col[n],s=t===m.Row?"misplaced-row":"misplaced-col",c=(t===m.Row?e.grid[o.row]:e.grid.map(a=>a[o.col])).filter(a=>a.state===i.Correct).map(a=>a.letter);Se.forEach((a,f)=>{/^[A-Z]$/.test(f)&&(a.classList.remove(...tt),c.includes(f)&&a.classList.add("correct"),r.misplaced.has(f)?a.classList.add(s):r.absent.has(f)&&a.classList.add("absent"))})},w=e=>{Qe(e),et(e),v(Ve,e.knowledge.row,"misplaced","misplaced-row"),v(qe,e.knowledge.row,"absent","absent"),v(We,e.knowledge.col,"misplaced","misplaced-col"),v(je,e.knowledge.col,"absent","absent"),ot(e),nt(e)},ee=(e,t,o,n)=>({row:e===m.Row?t:n,col:e===m.Row?n:o}),rt=(e,t,o,n)=>{e.knowledge.row[t].misplaced.delete(n),e.knowledge.row[t].absent.delete(n),e.knowledge.col[o].misplaced.delete(n),e.knowledge.col[o].absent.delete(n)},st=(e,t,o,n)=>{const r=ye(),s=r[o].some((c,a)=>c===t.letter&&e.grid[o][a].state!==i.Correct),l=r.some((c,a)=>c[n]===t.letter&&e.grid[a][n].state!==i.Correct);s&&l?(t.state=i.MisplacedBoth,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].misplaced.add(t.letter)):s?(t.state=i.MisplacedRow,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].absent.add(t.letter)):l?(t.state=i.MisplacedCol,e.knowledge.col[n].misplaced.add(t.letter),e.knowledge.row[o].absent.add(t.letter)):(t.state=i.Absent,e.knowledge.row[o].absent.add(t.letter),e.knowledge.col[n].absent.add(t.letter))},te=e=>{const{mode:t,grid:o,cursor:n}=e,r=t===m.Row?o[n.row]:o.map(d=>d[n.col]),s=r.map(d=>d.letter).join("");if(s.length<u)return{success:!1,error:"incomplete"};if(!Ge(s))return{success:!1,error:"invalid"};const l=ye(),c=[];r.forEach((d,h)=>{const{row:L,col:z}=ee(t,n.row,n.col,h),Ne=t===m.Row?l[n.row][h]:l[h][n.col],Be=d.state===i.Correct;d.letter===Ne&&(d.state=i.Correct,Be||c.push({row:L,col:z})),e.knowledge.col[z].misplaced.delete(d.letter),e.knowledge.row[L].misplaced.delete(d.letter)}),r.forEach((d,h)=>{if(d.state===i.Correct)return;const{row:L,col:z}=ee(t,n.row,n.col,h);rt(e,L,z,d.letter),st(e,d,L,z)}),t===m.Row?e.tries.row[n.row]++:e.tries.col[n.col]++;const a=r.every(d=>d.state===i.Correct),f=o.every(d=>d.every(h=>h.state===i.Correct));return{success:!0,newlyCorrect:c,lineComplete:a,puzzleComplete:f}},lt=400,ct=200,at=100,oe=(e,t)=>{const o=t==="horizontal"?"X":"Y",n=[{transform:`translate${o}(0)`},{transform:`translate${o}(-6px)`},{transform:`translate${o}(6px)`},{transform:`translate${o}(-4px)`},{transform:`translate${o}(4px)`},{transform:`translate${o}(0)`}];e.forEach(r=>{r.animate(n,{duration:lt,easing:"ease-in-out"})})},O=(e,t=0)=>{const o=[{transform:"scale(1)",offset:0},{transform:"scale(1.2)",offset:.5},{transform:"scale(1)",offset:1}];e.animate(o,{duration:ct,delay:t,easing:"ease-out"})},ne=e=>{e.forEach((t,o)=>{O(t,o*at)})},it=e=>{e.forEach((n,r)=>{n.forEach((s,l)=>{const a=(Math.abs(r-2)+Math.abs(l-2))*80;s.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.3) translateY(-10px)"},{transform:"scale(1) translateY(0)"}],{duration:400,delay:a,easing:"ease-out"})})})},dt=e=>{[...e.flat()].sort(()=>Math.random()-.5).forEach((n,r)=>{const s=r*40,l=1.2+Math.random()*.3;n.animate([{transform:"scale(1)",filter:"brightness(1)"},{transform:`scale(${l})`,filter:"brightness(1.5)"},{transform:"scale(1)",filter:"brightness(1)"}],{duration:300,delay:s,easing:"ease-out"})})},mt=e=>{const t=e.length,o=[];let n=0,r=t-1,s=0,l=t-1;for(;n<=r&&s<=l;){for(let c=s;c<=l;c++)o.push({row:n,col:c});n++;for(let c=n;c<=r;c++)o.push({row:c,col:l});if(l--,n<=r){for(let c=l;c>=s;c--)o.push({row:r,col:c});r--}if(s<=l){for(let c=r;c>=n;c--)o.push({row:c,col:s});s++}}o.forEach(({row:c,col:a},f)=>{const d=e[c][a],h=f*50;d.animate([{transform:"scale(1) rotate(0deg)"},{transform:"scale(1.2) rotate(10deg)"},{transform:"scale(1) rotate(0deg)"}],{duration:300,delay:h,easing:"ease-out"})})},ut=e=>{e.forEach((t,o)=>{t.forEach((n,r)=>{const s=(o+r)*60;n.animate([{transform:"translateY(0)"},{transform:"translateY(20px)"},{transform:"translateY(-15px)"},{transform:"translateY(10px)"},{transform:"translateY(-5px)"},{transform:"translateY(0)"}],{duration:500,delay:s,easing:"ease-out"})})})},pt=e=>{e.flat().forEach(o=>{const n=Math.random()*300,r=2+Math.floor(Math.random()*2);o.animate([{filter:"brightness(1)",transform:"scale(1)"},{filter:"brightness(1.8)",transform:"scale(1.1)"},{filter:"brightness(1)",transform:"scale(1)"}],{duration:250,delay:n,iterations:r,easing:"ease-in-out"})})},re=[it,dt,mt,ut,pt],se=e=>{const t=Math.floor(Math.random()*re.length);re[t](e)},A={SOLVED_PUZZLES:"tangled_solved_puzzles",HAS_PLAYED:"tangled_has_played",LANGUAGE:"tangled_language"},Z=()=>{try{const e=localStorage.getItem(A.SOLVED_PUZZLES);if(e)return new Set(JSON.parse(e))}catch{}return new Set},le=e=>{const t=Z();t.add(e),localStorage.setItem(A.SOLVED_PUZZLES,JSON.stringify([...t]))},ke=()=>localStorage.getItem(A.HAS_PLAYED)==="true",ve=()=>{localStorage.setItem(A.HAS_PLAYED,"true")},gt=()=>localStorage.getItem(A.LANGUAGE),ft=e=>{localStorage.setItem(A.LANGUAGE,e)},R=e=>e.mode===m.Row?g[e.cursor.row]:g.map(t=>t[e.cursor.col]),_=e=>{e.mode=e.mode===m.Row?m.Col:m.Row},P=(e,t)=>{const o=t==="down"||t==="right"?1:u-1;t==="up"||t==="down"?e.cursor.row=(e.cursor.row+o)%u:e.cursor.col=(e.cursor.col+o)%u},ce=e=>{const{row:t,col:o}=e.cursor;e.grid[t][o].state!==i.Correct&&(e.grid[t][o]={letter:"",state:i.Empty}),e.mode===m.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},ae=(e,t)=>{const{row:o,col:n}=e.cursor,r=e.grid[o][n];r.state!==i.Correct&&(r.letter=t.toUpperCase(),e.mode===m.Row?e.cursor.col=Math.min(u-1,e.cursor.col+1):e.cursor.row=Math.min(u-1,e.cursor.row+1))},ie=(e,t,o)=>{e.cursor.row=t,e.cursor.col=o},ht=e=>{window.addEventListener("keydown",s=>{switch(s.key){case" ":s.preventDefault(),_(e);break;case"ArrowUp":P(e,"up");break;case"ArrowDown":P(e,"down");break;case"ArrowLeft":P(e,"left");break;case"ArrowRight":P(e,"right");break;case"Backspace":ce(e);break;case"Enter":{const l=te(e);if(l.success)if(l.puzzleComplete)le(Q()),se(g);else if(l.lineComplete){const c=R(e);ne(c)}else l.newlyCorrect.length>0&&l.newlyCorrect.forEach(({row:c,col:a})=>{O(g[c][a])});else{const c=R(e),a=e.mode===m.Row?"horizontal":"vertical";oe(c,a)}break}default:/^[a-zA-Z]$/.test(s.key)&&ae(e,s.key)}w(e)});let t=0,o=null;const n=300;g.forEach((s,l)=>{s.forEach((c,a)=>{c.addEventListener("click",()=>{ie(e,l,a),w(e)}),c.addEventListener("dblclick",()=>{ie(e,l,a),_(e),w(e)}),c.addEventListener("touchend",f=>{const d=Date.now();o?.row===l&&o?.col===a&&d-t<n?(f.preventDefault(),_(e),w(e),t=0,o=null):(t=d,o={row:l,col:a})})})});const r=s=>{switch(s){case"⌫":ce(e);break;case"ENTER":{const l=te(e);if(l.success)if(l.puzzleComplete)le(Q()),se(g);else if(l.lineComplete){const c=R(e);ne(c)}else l.newlyCorrect.length>0&&l.newlyCorrect.forEach(({row:c,col:a})=>{O(g[c][a])});else{const c=R(e),a=e.mode===m.Row?"horizontal":"vertical";oe(c,a)}break}default:/^[A-Z]$/.test(s)&&ae(e,s)}w(e)};Se.forEach((s,l)=>{s.addEventListener("click",c=>{c.preventDefault(),r(l)})})},E=5,wt=120,Et=300,Ct=80,bt=2e3,yt=[["S","T","A","R","T"],["H","E","L","L","O"],["A","R","E","N","A"],["R","I","S","E","S"],["P","E","N","C","H"]],At=[[i.Correct,i.MisplacedRow,i.Correct,i.Absent,i.MisplacedCol],[i.MisplacedBoth,i.Correct,i.Absent,i.Correct,i.MisplacedRow],[i.Correct,i.Correct,i.Correct,i.Correct,i.Correct],[i.Absent,i.MisplacedCol,i.Correct,i.MisplacedBoth,i.Correct],[i.MisplacedRow,i.Absent,i.MisplacedCol,i.Correct,i.Correct]],Lt=e=>{e.innerHTML="";const t=[];for(let o=0;o<E;o++){t[o]=[];for(let n=0;n<E;n++){const r=document.createElement("div");r.className="mini-cell",e.appendChild(r),t[o][n]=r}}return t},zt=e=>{for(let t=0;t<E;t++)for(let o=0;o<E;o++)e[t][o].textContent="",e[t][o].className="mini-cell"},I=e=>new Promise(t=>setTimeout(t,e)),St=e=>{let t=!0;const o=Lt(e);return(async()=>{for(;t;){for(let r=0;r<E&&t;r++)for(let s=0;s<E&&t;s++)o[r][s].textContent=yt[r][s],await I(wt);if(!t||(await I(Et),!t))break;for(let r=0;r<E&&t;r++)for(let s=0;s<E&&t;s++){const l=At[r][s];o[r][s].classList.add(l),await I(Ct)}if(!t||(await I(bt),!t))break;zt(o)}})(),()=>{t=!1}};let p=null;const kt=()=>{const e=document.getElementById("language-btn");e&&(p=document.createElement("div"),p.className="language-dropdown",p.hidden=!0,fe.forEach(t=>{const o=document.createElement("button");o.className="language-option",o.dataset.lang=t.code,o.textContent=t.nativeName,t.code===k()&&o.classList.add("active"),o.addEventListener("click",()=>vt(t.code)),p.appendChild(o)}),e.parentElement?.appendChild(p),e.addEventListener("click",t=>{t.stopPropagation(),p&&(p.hidden=!p.hidden)}),document.addEventListener("click",()=>{p&&(p.hidden=!0)}))},Re=()=>{document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=x(t))}),document.querySelectorAll("[data-i18n-html]").forEach(e=>{const t=e.getAttribute("data-i18n-html");t&&(e.innerHTML=x(t))}),document.querySelectorAll("[data-i18n-aria]").forEach(e=>{const t=e.getAttribute("data-i18n-aria");t&&e.setAttribute("aria-label",x(t))}),p&&p.querySelectorAll(".language-option").forEach(e=>{const t=e.dataset.lang;e.classList.toggle("active",t===k())})},vt=async e=>{if(e===k()){p&&(p.hidden=!0);return}Ee(e),ft(e),await Promise.all([Ce(e),Ue(e)]),Re(),p&&(p.hidden=!0)},F=document.getElementById("homepage"),V=document.getElementById("game-container"),q=document.getElementById("puzzle-selector-screen"),Rt=document.getElementById("play-now-btn"),Pt=document.getElementById("select-puzzle-btn"),It=document.getElementById("back-to-home-btn"),D=document.getElementById("puzzle-grid"),de=document.getElementById("mini-grid"),Pe=document.getElementById("help-modal"),W=document.getElementById("help-btn"),Mt=document.getElementById("logo"),S=document.getElementById("puzzle-number");let C=null;const Ie=()=>{const t=new URLSearchParams(window.location.search).get("puzzle");return t&&/^\d+$/.test(t)?parseInt(t,10):null},M=()=>{F?.removeAttribute("hidden"),V?.setAttribute("hidden",""),q?.setAttribute("hidden",""),S?.setAttribute("hidden",""),W?.setAttribute("hidden","");const e=new URL(window.location.href);e.searchParams.delete("puzzle"),window.history.replaceState({},"",e.pathname),de&&!C&&(C=St(de))},Nt=()=>{F?.setAttribute("hidden",""),V?.setAttribute("hidden",""),q?.removeAttribute("hidden"),S?.setAttribute("hidden",""),W?.removeAttribute("hidden"),C&&(C(),C=null),Bt()},j=()=>{F?.setAttribute("hidden",""),V?.removeAttribute("hidden"),q?.setAttribute("hidden",""),W?.removeAttribute("hidden"),C&&(C(),C=null)},Bt=()=>{if(!D)return;const e=Ae(),t=Z();D.innerHTML="";for(let o=0;o<e;o++){const n=document.createElement("button");n.className="puzzle-item",t.has(o)&&n.classList.add("solved"),n.textContent=`#${String(o+1).padStart(3,"0")}`,n.addEventListener("click",()=>Me(o)),D.appendChild(n)}},J=e=>{S&&(S.textContent=`#${String(e+1).padStart(3,"0")}`,S.removeAttribute("hidden"))},Me=e=>{H(e),U(b);const t=new URL(window.location.href);t.searchParams.set("puzzle",String(e)),window.history.pushState({},"",t.toString()),j(),J(e),ke()||(Pe?.removeAttribute("hidden"),ve()),w(b)},Tt=()=>{const e=Ae(),t=Z(),o=[];for(let r=0;r<e;r++)t.has(r)||o.push(r);let n;o.length>0?n=o[Math.floor(Math.random()*o.length)]:n=Math.floor(Math.random()*e),Me(n)};window.addEventListener("popstate",()=>{const e=Ie();e!==null?(H(e),U(b),j(),J(e),w(b)):M()});const xt=async()=>{const t=gt()??$e();Ee(t),await Promise.all([Ce(t),ze(t),be(t)]),Re(),kt(),console.log("Game data loaded");const o=Ie();o!==null?(H(o),U(b),j(),J(o),ke()||(Pe?.removeAttribute("hidden"),ve())):M(),ht(b),w(b),Rt?.addEventListener("click",Tt),Pt?.addEventListener("click",Nt),It?.addEventListener("click",M),Mt?.addEventListener("click",n=>{n.preventDefault(),M()})};xt();
