(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&t(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const L=document.getElementById("theme-toggle");if(!L)throw new Error("Theme toggle button not found");localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark");function B(){document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}L.addEventListener("click",B);var a=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(a||{}),i=(e=>(e.Row="row",e.Col="col",e))(i||{});const d=5,R="/tangled",h=()=>({misplaced:new Set,absent:new Set}),N=()=>({mode:i.Row,cursor:{row:0,col:0},grid:Array.from({length:d},()=>Array.from({length:d},()=>({letter:"",state:a.Empty}))),knowledge:{row:Array.from({length:d},h),col:Array.from({length:d},h)}}),k=N();let z=[],S=1;const $=()=>fetch(`${R}/puzzles.txt`).then(e=>e.text()).then(e=>{z=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(r=>r.toUpperCase().split("")))}),A=()=>z[S]??[];let v=new Set;const x=()=>fetch(`${R}/guesses.txt`).then(e=>e.text()).then(e=>{v=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),K=e=>v.has(e),M=document.getElementById("board"),O=()=>{const e=[];for(let o=0;o<d;o++){const r=[];for(let t=0;t<d;t++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(o+1),n.style.gridColumn=String(t+1),M.appendChild(n),r.push(n)}e.push(r)}return e},I=e=>Array.from({length:d},()=>{const o=document.createElement("div");return o.className=`knowledge ${e}`,M.appendChild(o),o}),w=O(),U=I("row"),G=I("col"),b=(e,o,r)=>{e.forEach((t,n)=>{t.replaceChildren();const{misplaced:c,absent:m}=o[n];[...c].sort().forEach(l=>{const s=document.createElement("div");s.className=`knowledge-cell ${r}`,s.textContent=l,t.appendChild(s)}),[...m].sort().forEach(l=>{const s=document.createElement("div");s.className="knowledge-cell absent",s.textContent=l,t.appendChild(s)})})},H=e=>{for(let o=0;o<d;o++)for(let r=0;r<d;r++){const t=w[o][r],n=e.grid[o][r];t.className="cell",t.textContent=n.letter??"",t.classList.add(n.state)}},T=e=>{const{mode:o,cursor:r}=e;(o===i.Row?w[r.row]:w.map(n=>n[r.col])).forEach(n=>n.classList.add("highlight")),w[r.row][r.col].classList.add("cursor")},f=e=>{H(e),T(e),b(U,e.knowledge.row,"misplaced-row"),b(G,e.knowledge.col,"misplaced-col")},y=(e,o,r,t)=>({row:e===i.Row?o:t,col:e===i.Row?t:r}),D=(e,o,r,t)=>{e.knowledge.row[o].misplaced.delete(t),e.knowledge.row[o].absent.delete(t),e.knowledge.col[r].misplaced.delete(t),e.knowledge.col[r].absent.delete(t)},W=(e,o,r,t)=>{const n=A(),c=n[r].some((l,s)=>l===o.letter&&e.grid[r][s].state!==a.Correct),m=n.some((l,s)=>l[t]===o.letter&&e.grid[s][t].state!==a.Correct);c&&m?(o.state=a.MisplacedBoth,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].misplaced.add(o.letter)):c?(o.state=a.MisplacedRow,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].absent.add(o.letter)):m?(o.state=a.MisplacedCol,e.knowledge.col[t].misplaced.add(o.letter),e.knowledge.row[r].absent.add(o.letter)):(o.state=a.Absent,e.knowledge.row[r].absent.add(o.letter),e.knowledge.col[t].absent.add(o.letter))},Z=e=>{const{mode:o,grid:r,cursor:t}=e,n=o===i.Row?r[t.row]:r.map(l=>l[t.col]),c=n.map(l=>l.letter).join("");if(c.length<d)return console.error(`"${c}" is not ${d} characters long!`),!1;if(!K(c))return console.error(`"${c}" is not a valid word!`),!1;const m=A();return n.forEach((l,s)=>{const{row:u,col:g}=y(o,t.row,t.col,s),P=o===i.Row?m[t.row][s]:m[s][t.col];l.letter===P&&(l.state=a.Correct),e.knowledge.col[g].misplaced.delete(l.letter),e.knowledge.row[u].misplaced.delete(l.letter)}),n.forEach((l,s)=>{if(l.state===a.Correct)return;const{row:u,col:g}=y(o,t.row,t.col,s);D(e,u,g,l.letter),W(e,l,u,g)}),!0},E=e=>{e.mode=e.mode===i.Row?i.Col:i.Row},p=(e,o)=>{const r=o==="down"||o==="right"?1:d-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+r)%d:e.cursor.col=(e.cursor.col+r)%d},j=e=>{const{row:o,col:r}=e.cursor;e.grid[o][r].state!==a.Correct&&(e.grid[o][r]={letter:"",state:a.Empty}),e.mode===i.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},q=(e,o)=>{const{row:r,col:t}=e.cursor,n=e.grid[r][t];n.state!==a.Correct&&(n.letter=o.toUpperCase(),e.mode===i.Row?e.cursor.col=Math.min(d-1,e.cursor.col+1):e.cursor.row=Math.min(d-1,e.cursor.row+1))},C=(e,o,r)=>{e.cursor.row=o,e.cursor.col=r},F=e=>{window.addEventListener("keydown",o=>{switch(o.key){case" ":o.preventDefault(),E(e);break;case"ArrowUp":p(e,"up");break;case"ArrowDown":p(e,"down");break;case"ArrowLeft":p(e,"left");break;case"ArrowRight":p(e,"right");break;case"Backspace":j(e);break;case"Enter":Z(e);break;default:/^[a-zA-Z]$/.test(o.key)&&q(e,o.key)}f(e)}),w.forEach((o,r)=>{o.forEach((t,n)=>{t.addEventListener("click",()=>{C(e,r,n),f(e)}),t.addEventListener("dblclick",()=>{C(e,r,n),E(e),f(e)})})})};Promise.all([x(),$()]).then(()=>{console.log("Game data loaded"),F(k),f(k)});
