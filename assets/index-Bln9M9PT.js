(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const N=document.getElementById("theme-toggle");if(!N)throw new Error("Theme toggle button not found");localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark");function T(){document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}N.addEventListener("click",T);var m=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(m||{}),a=(e=>(e.Row="row",e.Col="col",e))(a||{});const i=5,k="/tangled",A=()=>({misplaced:new Set,absent:new Set}),P=()=>({mode:a.Row,cursor:{row:0,col:0},grid:Array.from({length:i},()=>Array.from({length:i},()=>({letter:"",state:m.Empty}))),knowledge:{row:Array.from({length:i},A),col:Array.from({length:i},A)}}),C=P(),Y=e=>{const o=P();e.mode=o.mode,e.cursor=o.cursor,e.grid=o.grid,e.knowledge=o.knowledge};let R=[],B=1;const $=()=>fetch(`${k}/puzzles.txt`).then(e=>e.text()).then(e=>{R=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(r=>r.toUpperCase().split("")))}),O=()=>R[B]??[],U=e=>{e>=0&&e<R.length&&(B=e)};let D=new Set;const X=()=>fetch(`${k}/guesses.txt`).then(e=>e.text()).then(e=>{D=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),_=e=>D.has(e),K=document.getElementById("board"),W=document.getElementById("keyboard"),Z=()=>{const e=[];for(let o=0;o<i;o++){const r=[];for(let t=0;t<i;t++){const s=document.createElement("div");s.className="cell",s.style.gridRow=String(o+2),s.style.gridColumn=String(t+2),K.appendChild(s),r.push(s)}e.push(r)}return e},b=e=>Array.from({length:i},(o,r)=>{const t=document.createElement("div");return t.className=`knowledge ${e.className}`,t.style.gridRow=e.gridRow(r),t.style.gridColumn=e.gridColumn(r),K.appendChild(t),t}),g=Z(),G=b({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),H=b({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),F=b({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),V=b({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),j=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["MODE","Z","X","C","V","B","N","M","⌫"],["ENTER"]],q=()=>{const e=new Map;return j.forEach(o=>{const r=document.createElement("div");r.className="keyboard-row",o.forEach(t=>{const s=document.createElement("button");s.className="keyboard-key",s.dataset.key=t,t==="MODE"?s.classList.add("wide","mode-toggle","row-mode"):t==="⌫"?(s.textContent="⌫",s.classList.add("wide")):t==="ENTER"?(s.textContent="ENTER",s.style.maxWidth="100%",s.style.flex="1"):s.textContent=t,e.set(t,s),r.appendChild(s)}),W.appendChild(r)}),e},y=q(),f=(e,o,r,t)=>{e.forEach((s,n)=>{s.replaceChildren(),[...o[n][r]].sort().forEach(c=>{const l=document.createElement("div");l.className=`knowledge-cell ${t}`,l.textContent=c,s.appendChild(l)})})},J=e=>{for(let o=0;o<i;o++)for(let r=0;r<i;r++){const t=g[o][r],s=e.grid[o][r];t.className="cell",t.textContent=s.letter??"",t.classList.add(s.state)}},Q=e=>{const{mode:o,cursor:r}=e;(o===a.Row?g[r.row]:g.map(s=>s[r.col])).forEach(s=>s.classList.add("highlight")),g[r.row][r.col].classList.add("cursor")},ee=["correct","misplaced-row","misplaced-col","absent"],oe=e=>{const{mode:o,cursor:r}=e,t=o===a.Row?r.row:r.col,s=o===a.Row?e.knowledge.row[t]:e.knowledge.col[t],n=o===a.Row?"misplaced-row":"misplaced-col",c=(o===a.Row?e.grid[r.row]:e.grid.map(l=>l[r.col])).filter(l=>l.state===m.Correct).map(l=>l.letter);y.forEach((l,u)=>{/^[A-Z]$/.test(u)&&(l.classList.remove(...ee),c.includes(u)&&l.classList.add("correct"),s.misplaced.has(u)?l.classList.add(n):s.absent.has(u)&&l.classList.add("absent"))})},p=e=>{J(e),Q(e),f(G,e.knowledge.row,"misplaced","misplaced-row"),f(H,e.knowledge.row,"absent","absent"),f(F,e.knowledge.col,"misplaced","misplaced-col"),f(V,e.knowledge.col,"absent","absent"),oe(e)},S=(e,o,r,t)=>({row:e===a.Row?o:t,col:e===a.Row?t:r}),re=(e,o,r,t)=>{e.knowledge.row[o].misplaced.delete(t),e.knowledge.row[o].absent.delete(t),e.knowledge.col[r].misplaced.delete(t),e.knowledge.col[r].absent.delete(t)},te=(e,o,r,t)=>{const s=O(),n=s[r].some((c,l)=>c===o.letter&&e.grid[r][l].state!==m.Correct),d=s.some((c,l)=>c[t]===o.letter&&e.grid[l][t].state!==m.Correct);n&&d?(o.state=m.MisplacedBoth,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].misplaced.add(o.letter)):n?(o.state=m.MisplacedRow,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].absent.add(o.letter)):d?(o.state=m.MisplacedCol,e.knowledge.col[t].misplaced.add(o.letter),e.knowledge.row[r].absent.add(o.letter)):(o.state=m.Absent,e.knowledge.row[r].absent.add(o.letter),e.knowledge.col[t].absent.add(o.letter))},z=e=>{const{mode:o,grid:r,cursor:t}=e,s=o===a.Row?r[t.row]:r.map(c=>c[t.col]),n=s.map(c=>c.letter).join("");if(n.length<i)return{success:!1,error:"incomplete"};if(!_(n))return{success:!1,error:"invalid"};const d=O();return s.forEach((c,l)=>{const{row:u,col:w}=S(o,t.row,t.col,l),L=o===a.Row?d[t.row][l]:d[l][t.col];c.letter===L&&(c.state=m.Correct),e.knowledge.col[w].misplaced.delete(c.letter),e.knowledge.row[u].misplaced.delete(c.letter)}),s.forEach((c,l)=>{if(c.state===m.Correct)return;const{row:u,col:w}=S(o,t.row,t.col,l);re(e,u,w,c.letter),te(e,c,u,w)}),{success:!0}},se=e=>e.mode===a.Row?g[e.cursor.row]:g.map(o=>o[e.cursor.col]),x=e=>{const o=se(e),t=e.mode===a.Row?[{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(-4px)"},{transform:"translateX(4px)"},{transform:"translateX(0)"}]:[{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(6px)"},{transform:"translateY(-4px)"},{transform:"translateY(4px)"},{transform:"translateY(0)"}];o.forEach(s=>{s.animate(t,{duration:400,easing:"ease-in-out"})})},h=e=>{e.mode=e.mode===a.Row?a.Col:a.Row,ne(e)},ne=e=>{const o=y.get("MODE");o&&(o.classList.toggle("row-mode",e.mode===a.Row),o.classList.toggle("col-mode",e.mode===a.Col))},E=(e,o)=>{const r=o==="down"||o==="right"?1:i-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+r)%i:e.cursor.col=(e.cursor.col+r)%i},I=e=>{const{row:o,col:r}=e.cursor;e.grid[o][r].state!==m.Correct&&(e.grid[o][r]={letter:"",state:m.Empty}),e.mode===a.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},M=(e,o)=>{const{row:r,col:t}=e.cursor,s=e.grid[r][t];s.state!==m.Correct&&(s.letter=o.toUpperCase(),e.mode===a.Row?e.cursor.col=Math.min(i-1,e.cursor.col+1):e.cursor.row=Math.min(i-1,e.cursor.row+1))},v=(e,o,r)=>{e.cursor.row=o,e.cursor.col=r},le=e=>{window.addEventListener("keydown",n=>{switch(n.key){case" ":n.preventDefault(),h(e);break;case"ArrowUp":E(e,"up");break;case"ArrowDown":E(e,"down");break;case"ArrowLeft":E(e,"left");break;case"ArrowRight":E(e,"right");break;case"Backspace":I(e);break;case"Enter":{z(e).success||x(e);break}default:/^[a-zA-Z]$/.test(n.key)&&M(e,n.key)}p(e)});let o=0,r=null;const t=300;g.forEach((n,d)=>{n.forEach((c,l)=>{c.addEventListener("click",()=>{v(e,d,l),p(e)}),c.addEventListener("dblclick",()=>{v(e,d,l),h(e),p(e)}),c.addEventListener("touchend",u=>{const w=Date.now();r?.row===d&&r?.col===l&&w-o<t?(u.preventDefault(),h(e),p(e),o=0,r=null):(o=w,r={row:d,col:l})})})});const s=n=>{switch(n){case"MODE":h(e);break;case"⌫":I(e);break;case"ENTER":{z(e).success||x(e);break}default:/^[A-Z]$/.test(n)&&M(e,n)}p(e)};y.forEach((n,d)=>{n.addEventListener("click",c=>{c.preventDefault(),s(d)})})},ce=()=>{const e=sessionStorage.getItem("redirectPath"),o=e||window.location.pathname;e&&sessionStorage.removeItem("redirectPath");const r=o.match(new RegExp(`^${k}/puzzles/(\\d+)$`));return r?parseInt(r[1],10):null};Promise.all([X(),$()]).then(()=>{console.log("Game data loaded");const e=ce();e!==null&&(U(e),Y(C)),le(C),p(C)});
