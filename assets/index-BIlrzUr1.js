(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();const se=document.getElementById("theme-toggle");if(!se)throw new Error("Theme toggle button not found");const P=document.getElementById("logo"),ze={correct:"--cell-correct","misplaced-both":"--cell-misplaced-both","misplaced-row":"--cell-misplaced-row","misplaced-col":"--cell-misplaced-col"};if(P){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],t=e[Math.floor(Math.random()*e.length)];P.classList.add(t);const o=ze[t];document.documentElement.style.setProperty("--primary-color",`var(${o})`)}function ce(){P&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle(P),t=getComputedStyle(document.documentElement),o=e.backgroundColor,r=t.getPropertyValue("--text-color").trim(),n=t.getPropertyValue("--cell-border").trim(),l=document.createElement("canvas");l.width=64,l.height=64;const s=l.getContext("2d");if(s){s.fillStyle=n,s.fillRect(0,0,64,64);const c=4;s.fillStyle=o,s.fillRect(c,c,64-c*2,64-c*2),s.fillStyle=r,s.font="bold 40px system-ui, sans-serif",s.textAlign="center",s.textBaseline="middle",s.fillText("T",32,34);let a=document.querySelector("link[rel='icon']");a||(a=document.createElement("link"),a.rel="icon",document.head.appendChild(a)),a.href=l.toDataURL("image/png")}})})}ce();function Ae(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),ce()}se.addEventListener("click",Ae);const Le=document.getElementById("help-btn"),b=document.getElementById("help-modal"),Se=b?.querySelector(".modal-close"),ke=b?.querySelector(".modal-backdrop");function ae(){b?.removeAttribute("hidden")}function _(){b?.setAttribute("hidden","")}Le?.addEventListener("click",ae);Se?.addEventListener("click",_);ke?.addEventListener("click",_);document.addEventListener("keydown",e=>{e.key==="Escape"&&b&&(b.hasAttribute("hidden")?ae():_())});var d=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(d||{}),m=(e=>(e.Row="row",e.Col="col",e))(m||{});const u=5,de="/tangled",F=()=>({misplaced:new Set,absent:new Set}),ie=()=>({mode:m.Row,cursor:{row:0,col:0},grid:Array.from({length:u},()=>Array.from({length:u},()=>({letter:"",state:d.Empty}))),knowledge:{row:Array.from({length:u},F),col:Array.from({length:u},F)},tries:{row:Array.from({length:u},()=>0),col:Array.from({length:u},()=>0)}}),C=ie(),D=e=>{const t=ie();e.mode=t.mode,e.cursor=t.cursor,e.grid=t.grid,e.knowledge=t.knowledge,e.tries=t.tries};let M=[],O=1;const Re=()=>fetch(`${de}/puzzles.txt`).then(e=>e.text()).then(e=>{M=e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map(t=>t.split(/\s+/).map(o=>o.toUpperCase().split("")))}),me=()=>M[O]??[],Y=e=>{e>=0&&e<M.length&&(O=e)},q=()=>O,ue=()=>M.length;let pe=new Set;const ve=()=>fetch(`${de}/guesses.txt`).then(e=>e.text()).then(e=>{pe=new Set(e.split(`
`).map(t=>t.trim().toUpperCase()))}),Pe=e=>pe.has(e),$=document.getElementById("board"),Me=document.getElementById("keyboard"),Ie=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const t=document.createElement("div");t.className="tries-label",t.textContent="TRIES";const o=document.createElement("div");return o.className="tries-count",o.textContent="0",e.appendChild(t),e.appendChild(o),$.appendChild(e),o},Te=Ie(),Be=()=>{const e=[];for(let t=0;t<u;t++){const o=[];for(let r=0;r<u;r++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(t+2),n.style.gridColumn=String(r+2),$.appendChild(n),o.push(n)}e.push(o)}return e},I=e=>Array.from({length:u},(t,o)=>{const r=document.createElement("div");return r.className=`knowledge ${e.className}`,r.style.gridRow=e.gridRow(o),r.style.gridColumn=e.gridColumn(o),$.appendChild(r),r}),p=Be(),xe=I({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),Ne=I({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),_e=I({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),De=I({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),Oe=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],Ye=()=>{const e=new Map;return Oe.forEach(t=>{const o=document.createElement("div");o.className="keyboard-row",t.forEach(r=>{const n=document.createElement("button");n.className="keyboard-key",n.dataset.key=r,r==="ENTER"?(n.textContent="ENTER",n.classList.add("wide")):r==="⌫"?(n.textContent="⌫",n.classList.add("wide")):n.textContent=r,e.set(r,n),o.appendChild(n)}),Me.appendChild(o)}),e},fe=Ye(),L=(e,t,o,r)=>{e.forEach((n,l)=>{n.replaceChildren(),[...t[l][o]].sort().forEach(c=>{const a=document.createElement("div");a.className=`knowledge-cell ${r}`,a.textContent=c,n.appendChild(a)})})},$e=e=>{for(let t=0;t<u;t++)for(let o=0;o<u;o++){const r=p[t][o],n=e.grid[t][o];r.className="cell",r.textContent=n.letter??"",r.classList.add(n.state)}},Ue=e=>{const{mode:t,cursor:o}=e;(t===m.Row?p[o.row]:p.map(n=>n[o.col])).forEach(n=>n.classList.add("highlight")),p[o.row][o.col].classList.add("cursor")},He=["correct","misplaced-row","misplaced-col","absent"],Ke=e=>{const t=e.tries.row.reduce((o,r)=>o+r,0)+e.tries.col.reduce((o,r)=>o+r,0);Te.textContent=String(t)},Ge=e=>{const{mode:t,cursor:o}=e,r=t===m.Row?o.row:o.col,n=t===m.Row?e.knowledge.row[r]:e.knowledge.col[r],l=t===m.Row?"misplaced-row":"misplaced-col",c=(t===m.Row?e.grid[o.row]:e.grid.map(a=>a[o.col])).filter(a=>a.state===d.Correct).map(a=>a.letter);fe.forEach((a,f)=>{/^[A-Z]$/.test(f)&&(a.classList.remove(...He),c.includes(f)&&a.classList.add("correct"),n.misplaced.has(f)?a.classList.add(l):n.absent.has(f)&&a.classList.add("absent"))})},h=e=>{$e(e),Ue(e),L(xe,e.knowledge.row,"misplaced","misplaced-row"),L(Ne,e.knowledge.row,"absent","absent"),L(_e,e.knowledge.col,"misplaced","misplaced-col"),L(De,e.knowledge.col,"absent","absent"),Ke(e),Ge(e)},W=(e,t,o,r)=>({row:e===m.Row?t:r,col:e===m.Row?r:o}),Ze=(e,t,o,r)=>{e.knowledge.row[t].misplaced.delete(r),e.knowledge.row[t].absent.delete(r),e.knowledge.col[o].misplaced.delete(r),e.knowledge.col[o].absent.delete(r)},Ve=(e,t,o,r)=>{const n=me(),l=n[o].some((c,a)=>c===t.letter&&e.grid[o][a].state!==d.Correct),s=n.some((c,a)=>c[r]===t.letter&&e.grid[a][r].state!==d.Correct);l&&s?(t.state=d.MisplacedBoth,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[r].misplaced.add(t.letter)):l?(t.state=d.MisplacedRow,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[r].absent.add(t.letter)):s?(t.state=d.MisplacedCol,e.knowledge.col[r].misplaced.add(t.letter),e.knowledge.row[o].absent.add(t.letter)):(t.state=d.Absent,e.knowledge.row[o].absent.add(t.letter),e.knowledge.col[r].absent.add(t.letter))},J=e=>{const{mode:t,grid:o,cursor:r}=e,n=t===m.Row?o[r.row]:o.map(i=>i[r.col]),l=n.map(i=>i.letter).join("");if(l.length<u)return{success:!1,error:"incomplete"};if(!Pe(l))return{success:!1,error:"invalid"};const s=me(),c=[];n.forEach((i,g)=>{const{row:y,col:z}=W(t,r.row,r.col,g),be=t===m.Row?s[r.row][g]:s[g][r.col],ye=i.state===d.Correct;i.letter===be&&(i.state=d.Correct,ye||c.push({row:y,col:z})),e.knowledge.col[z].misplaced.delete(i.letter),e.knowledge.row[y].misplaced.delete(i.letter)}),n.forEach((i,g)=>{if(i.state===d.Correct)return;const{row:y,col:z}=W(t,r.row,r.col,g);Ze(e,y,z,i.letter),Ve(e,i,y,z)}),t===m.Row?e.tries.row[r.row]++:e.tries.col[r.col]++;const a=n.every(i=>i.state===d.Correct),f=o.every(i=>i.every(g=>g.state===d.Correct));return{success:!0,newlyCorrect:c,lineComplete:a,puzzleComplete:f}},Fe=400,qe=200,We=100,X=(e,t)=>{const o=t==="horizontal"?"X":"Y",r=[{transform:`translate${o}(0)`},{transform:`translate${o}(-6px)`},{transform:`translate${o}(6px)`},{transform:`translate${o}(-4px)`},{transform:`translate${o}(4px)`},{transform:`translate${o}(0)`}];e.forEach(n=>{n.animate(r,{duration:Fe,easing:"ease-in-out"})})},N=(e,t=0)=>{const o=[{transform:"scale(1)",offset:0},{transform:"scale(1.2)",offset:.5},{transform:"scale(1)",offset:1}];e.animate(o,{duration:qe,delay:t,easing:"ease-out"})},j=e=>{e.forEach((t,o)=>{N(t,o*We)})},Je=e=>{e.forEach((r,n)=>{r.forEach((l,s)=>{const a=(Math.abs(n-2)+Math.abs(s-2))*80;l.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.3) translateY(-10px)"},{transform:"scale(1) translateY(0)"}],{duration:400,delay:a,easing:"ease-out"})})})},Xe=e=>{[...e.flat()].sort(()=>Math.random()-.5).forEach((r,n)=>{const l=n*40,s=1.2+Math.random()*.3;r.animate([{transform:"scale(1)",filter:"brightness(1)"},{transform:`scale(${s})`,filter:"brightness(1.5)"},{transform:"scale(1)",filter:"brightness(1)"}],{duration:300,delay:l,easing:"ease-out"})})},je=e=>{const t=e.length,o=[];let r=0,n=t-1,l=0,s=t-1;for(;r<=n&&l<=s;){for(let c=l;c<=s;c++)o.push({row:r,col:c});r++;for(let c=r;c<=n;c++)o.push({row:c,col:s});if(s--,r<=n){for(let c=s;c>=l;c--)o.push({row:n,col:c});n--}if(l<=s){for(let c=n;c>=r;c--)o.push({row:c,col:l});l++}}o.forEach(({row:c,col:a},f)=>{const i=e[c][a],g=f*50;i.animate([{transform:"scale(1) rotate(0deg)"},{transform:"scale(1.2) rotate(10deg)"},{transform:"scale(1) rotate(0deg)"}],{duration:300,delay:g,easing:"ease-out"})})},Qe=e=>{e.forEach((t,o)=>{t.forEach((r,n)=>{const l=(o+n)*60;r.animate([{transform:"translateY(0)"},{transform:"translateY(20px)"},{transform:"translateY(-15px)"},{transform:"translateY(10px)"},{transform:"translateY(-5px)"},{transform:"translateY(0)"}],{duration:500,delay:l,easing:"ease-out"})})})},et=e=>{e.flat().forEach(o=>{const r=Math.random()*300,n=2+Math.floor(Math.random()*2);o.animate([{filter:"brightness(1)",transform:"scale(1)"},{filter:"brightness(1.8)",transform:"scale(1.1)"},{filter:"brightness(1)",transform:"scale(1)"}],{duration:250,delay:r,iterations:n,easing:"ease-in-out"})})},Q=[Je,Xe,je,Qe,et],ee=e=>{const t=Math.floor(Math.random()*Q.length);Q[t](e)},T={SOLVED_PUZZLES:"tangled_solved_puzzles",HAS_PLAYED:"tangled_has_played"},U=()=>{try{const e=localStorage.getItem(T.SOLVED_PUZZLES);if(e)return new Set(JSON.parse(e))}catch{}return new Set},te=e=>{const t=U();t.add(e),localStorage.setItem(T.SOLVED_PUZZLES,JSON.stringify([...t]))},ge=()=>localStorage.getItem(T.HAS_PLAYED)==="true",he=()=>{localStorage.setItem(T.HAS_PLAYED,"true")},S=e=>e.mode===m.Row?p[e.cursor.row]:p.map(t=>t[e.cursor.col]),B=e=>{e.mode=e.mode===m.Row?m.Col:m.Row},k=(e,t)=>{const o=t==="down"||t==="right"?1:u-1;t==="up"||t==="down"?e.cursor.row=(e.cursor.row+o)%u:e.cursor.col=(e.cursor.col+o)%u},oe=e=>{const{row:t,col:o}=e.cursor;e.grid[t][o].state!==d.Correct&&(e.grid[t][o]={letter:"",state:d.Empty}),e.mode===m.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},re=(e,t)=>{const{row:o,col:r}=e.cursor,n=e.grid[o][r];n.state!==d.Correct&&(n.letter=t.toUpperCase(),e.mode===m.Row?e.cursor.col=Math.min(u-1,e.cursor.col+1):e.cursor.row=Math.min(u-1,e.cursor.row+1))},ne=(e,t,o)=>{e.cursor.row=t,e.cursor.col=o},tt=e=>{window.addEventListener("keydown",l=>{switch(l.key){case" ":l.preventDefault(),B(e);break;case"ArrowUp":k(e,"up");break;case"ArrowDown":k(e,"down");break;case"ArrowLeft":k(e,"left");break;case"ArrowRight":k(e,"right");break;case"Backspace":oe(e);break;case"Enter":{const s=J(e);if(s.success)if(s.puzzleComplete)te(q()),ee(p);else if(s.lineComplete){const c=S(e);j(c)}else s.newlyCorrect.length>0&&s.newlyCorrect.forEach(({row:c,col:a})=>{N(p[c][a])});else{const c=S(e),a=e.mode===m.Row?"horizontal":"vertical";X(c,a)}break}default:/^[a-zA-Z]$/.test(l.key)&&re(e,l.key)}h(e)});let t=0,o=null;const r=300;p.forEach((l,s)=>{l.forEach((c,a)=>{c.addEventListener("click",()=>{ne(e,s,a),h(e)}),c.addEventListener("dblclick",()=>{ne(e,s,a),B(e),h(e)}),c.addEventListener("touchend",f=>{const i=Date.now();o?.row===s&&o?.col===a&&i-t<r?(f.preventDefault(),B(e),h(e),t=0,o=null):(t=i,o={row:s,col:a})})})});const n=l=>{switch(l){case"⌫":oe(e);break;case"ENTER":{const s=J(e);if(s.success)if(s.puzzleComplete)te(q()),ee(p);else if(s.lineComplete){const c=S(e);j(c)}else s.newlyCorrect.length>0&&s.newlyCorrect.forEach(({row:c,col:a})=>{N(p[c][a])});else{const c=S(e),a=e.mode===m.Row?"horizontal":"vertical";X(c,a)}break}default:/^[A-Z]$/.test(l)&&re(e,l)}h(e)};fe.forEach((l,s)=>{l.addEventListener("click",c=>{c.preventDefault(),n(s)})})},w=5,ot=120,rt=300,nt=80,lt=2e3,st=[["S","T","A","R","T"],["H","E","L","L","O"],["A","R","E","N","A"],["R","I","S","E","S"],["P","E","N","C","H"]],ct=[[d.Correct,d.MisplacedRow,d.Correct,d.Absent,d.MisplacedCol],[d.MisplacedBoth,d.Correct,d.Absent,d.Correct,d.MisplacedRow],[d.Correct,d.Correct,d.Correct,d.Correct,d.Correct],[d.Absent,d.MisplacedCol,d.Correct,d.MisplacedBoth,d.Correct],[d.MisplacedRow,d.Absent,d.MisplacedCol,d.Correct,d.Correct]],at=e=>{e.innerHTML="";const t=[];for(let o=0;o<w;o++){t[o]=[];for(let r=0;r<w;r++){const n=document.createElement("div");n.className="mini-cell",e.appendChild(n),t[o][r]=n}}return t},dt=e=>{for(let t=0;t<w;t++)for(let o=0;o<w;o++)e[t][o].textContent="",e[t][o].className="mini-cell"},R=e=>new Promise(t=>setTimeout(t,e)),it=e=>{let t=!0;const o=at(e);return(async()=>{for(;t;){for(let n=0;n<w&&t;n++)for(let l=0;l<w&&t;l++)o[n][l].textContent=st[n][l],await R(ot);if(!t||(await R(rt),!t))break;for(let n=0;n<w&&t;n++)for(let l=0;l<w&&t;l++){const s=ct[n][l];o[n][l].classList.add(s),await R(nt)}if(!t||(await R(lt),!t))break;dt(o)}})(),()=>{t=!1}},H=document.getElementById("homepage"),K=document.getElementById("game-container"),G=document.getElementById("puzzle-selector-screen"),mt=document.getElementById("play-now-btn"),ut=document.getElementById("select-puzzle-btn"),pt=document.getElementById("back-to-home-btn"),x=document.getElementById("puzzle-grid"),le=document.getElementById("mini-grid"),we=document.getElementById("help-modal"),ft=document.getElementById("logo"),A=document.getElementById("puzzle-number");let E=null;const Ee=()=>{const t=new URLSearchParams(window.location.search).get("puzzle");return t&&/^\d+$/.test(t)?parseInt(t,10):null},v=()=>{H?.removeAttribute("hidden"),K?.setAttribute("hidden",""),G?.setAttribute("hidden",""),A?.setAttribute("hidden","");const e=new URL(window.location.href);e.searchParams.delete("puzzle"),window.history.replaceState({},"",e.pathname),le&&!E&&(E=it(le))},gt=()=>{H?.setAttribute("hidden",""),K?.setAttribute("hidden",""),G?.removeAttribute("hidden"),A?.setAttribute("hidden",""),E&&(E(),E=null),ht()},Z=()=>{H?.setAttribute("hidden",""),K?.removeAttribute("hidden"),G?.setAttribute("hidden",""),E&&(E(),E=null)},ht=()=>{if(!x)return;const e=ue(),t=U();x.innerHTML="";for(let o=0;o<e;o++){const r=document.createElement("button");r.className="puzzle-item",t.has(o)&&r.classList.add("solved"),r.textContent=`#${String(o+1).padStart(3,"0")}`,r.addEventListener("click",()=>Ce(o)),x.appendChild(r)}},V=e=>{A&&(A.textContent=`#${String(e+1).padStart(3,"0")}`,A.removeAttribute("hidden"))},Ce=e=>{Y(e),D(C);const t=new URL(window.location.href);t.searchParams.set("puzzle",String(e)),window.history.pushState({},"",t.toString()),Z(),V(e),ge()||(we?.removeAttribute("hidden"),he()),h(C)},wt=()=>{const e=ue(),t=U(),o=[];for(let n=0;n<e;n++)t.has(n)||o.push(n);let r;o.length>0?r=o[Math.floor(Math.random()*o.length)]:r=Math.floor(Math.random()*e),Ce(r)};window.addEventListener("popstate",()=>{const e=Ee();e!==null?(Y(e),D(C),Z(),V(e),h(C)):v()});Promise.all([ve(),Re()]).then(()=>{console.log("Game data loaded");const e=Ee();e!==null?(Y(e),D(C),Z(),V(e),ge()||(we?.removeAttribute("hidden"),he())):v(),tt(C),h(C),mt?.addEventListener("click",wt),ut?.addEventListener("click",gt),pt?.addEventListener("click",v),ft?.addEventListener("click",t=>{t.preventDefault(),v()})});
