(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Re=document.getElementById("theme-toggle");if(!Re)throw new Error("Theme toggle button not found");const $=document.getElementById("logo"),rt={correct:"--cell-correct","misplaced-both":"--cell-misplaced-both","misplaced-row":"--cell-misplaced-row","misplaced-col":"--cell-misplaced-col"};if($){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],t=e[Math.floor(Math.random()*e.length)];$.classList.add(t);const o=rt[t];document.documentElement.style.setProperty("--primary-color",`var(${o})`)}function Me(){$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle($),t=getComputedStyle(document.documentElement),o=e.backgroundColor,n=t.getPropertyValue("--text-color").trim(),r=t.getPropertyValue("--cell-border").trim(),s=document.createElement("canvas");s.width=64,s.height=64;const a=s.getContext("2d");if(a){a.fillStyle=r,a.fillRect(0,0,64,64);const l=4;a.fillStyle=o,a.fillRect(l,l,64-l*2,64-l*2),a.fillStyle=n,a.font="bold 40px system-ui, sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText("T",32,34);let c=document.querySelector("link[rel='icon']");c||(c=document.createElement("link"),c.rel="icon",document.head.appendChild(c)),c.href=s.toDataURL("image/png")}})})}Me();function st(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),Me()}Re.addEventListener("click",st);const at=document.getElementById("help-btn"),D=document.getElementById("help-modal"),lt=D?.querySelector(".modal-close"),ct=D?.querySelector(".modal-backdrop");function Te(){D?.removeAttribute("hidden")}function Q(){D?.setAttribute("hidden","")}at?.addEventListener("click",Te);lt?.addEventListener("click",Q);ct?.addEventListener("click",Q);document.addEventListener("keydown",e=>{e.key==="Escape"&&D&&(D.hasAttribute("hidden")?Te():Q())});var d=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(d||{}),m=(e=>(e.Row="row",e.Col="col",e))(m||{});const g=5,ee="/tangled",fe=()=>({misplaced:new Set,absent:new Set}),Ne=()=>({mode:m.Row,cursor:{row:0,col:0},grid:Array.from({length:g},()=>Array.from({length:g},()=>({letter:"",state:d.Empty}))),knowledge:{row:Array.from({length:g},fe),col:Array.from({length:g},fe)},tries:{row:Array.from({length:g},()=>0),col:Array.from({length:g},()=>0)},completed:!1}),v=Ne(),te=e=>{const t=Ne();e.mode=t.mode,e.cursor=t.cursor,e.grid=t.grid,e.knowledge=t.knowledge,e.tries=t.tries,e.completed=t.completed};let U=[],oe=1,q="en";const xe=e=>{const t=e??q;return q=t,fetch(`${ee}/puzzles/${t}.txt`).then(o=>o.text()).then(o=>{U=o.split(`
`).map(n=>n.trim()).filter(n=>n.length>0).map(n=>n.split(/\s+/).map(r=>r.toUpperCase().split("")))})},Be=()=>U[oe]??[],ne=e=>{e>=0&&e<U.length&&(oe=e)},W=()=>oe,P=()=>U.length;let Oe=new Set;const _e=e=>fetch(`${ee}/words/${e??q}.txt`).then(o=>o.text()).then(o=>{Oe=new Set(o.split(`
`).map(n=>n.trim().toUpperCase()))}),dt=e=>Oe.has(e),it=e=>Promise.all([xe(e),_e(e)]).then(()=>{}),pe=(e,t,o,n)=>({row:e===m.Row?t:n,col:e===m.Row?n:o}),ut=(e,t,o,n)=>{e.knowledge.row[t].misplaced.delete(n),e.knowledge.row[t].absent.delete(n),e.knowledge.col[o].misplaced.delete(n),e.knowledge.col[o].absent.delete(n)},mt=(e,t,o,n)=>{const r=Be(),s=r[o].some((l,c)=>l===t.letter&&e.grid[o][c].state!==d.Correct),a=r.some((l,c)=>l[n]===t.letter&&e.grid[c][n].state!==d.Correct);s&&a?(t.state=d.MisplacedBoth,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].misplaced.add(t.letter)):s?(t.state=d.MisplacedRow,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].absent.add(t.letter)):a?(t.state=d.MisplacedCol,e.knowledge.col[n].misplaced.add(t.letter),e.knowledge.row[o].absent.add(t.letter)):(t.state=d.Absent,e.knowledge.row[o].absent.add(t.letter),e.knowledge.col[n].absent.add(t.letter))},he=e=>{const{mode:t,grid:o,cursor:n}=e,r=t===m.Row?o[n.row]:o.map(i=>i[n.col]),s=r.map(i=>i.letter).join("");if(s.length<g)return{success:!1,error:"incomplete"};if(!dt(s))return{success:!1,error:"invalid"};const a=Be(),l=[];r.forEach((i,f)=>{const{row:k,col:R}=pe(t,n.row,n.col,f),ot=t===m.Row?a[n.row][f]:a[f][n.col],nt=i.state===d.Correct;i.letter===ot&&(i.state=d.Correct,nt||l.push({row:k,col:R})),e.knowledge.col[R].misplaced.delete(i.letter),e.knowledge.row[k].misplaced.delete(i.letter)}),r.forEach((i,f)=>{if(i.state===d.Correct)return;const{row:k,col:R}=pe(t,n.row,n.col,f);ut(e,k,R,i.letter),mt(e,i,k,R)}),e.completed||(t===m.Row?e.tries.row[n.row]++:e.tries.col[n.col]++);const c=r.every(i=>i.state===d.Correct),u=o.every(i=>i.every(f=>f.state===d.Correct));return u&&(e.completed=!0),{success:!0,newlyCorrect:l,lineComplete:c,puzzleComplete:u}},C=new Date("2026-02-01T00:00:00"),re=()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())},V=()=>{const t=re().getTime()-C.getTime(),o=Math.floor(t/(1e3*60*60*24));return Math.max(0,o)},Z=e=>{const t=new Date(C);return t.setDate(t.getDate()+e),t},Ye=e=>{const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`},gt=()=>Ye(re()),G=e=>{const t=Z(e),o=re();return t.getTime()<=o.getTime()},ft=(e,t)=>{const o=Ye(Z(e));return t===o},h={SOLVED_PUZZLES:"tangled_solved_puzzles",HAS_PLAYED:"tangled_has_played",LANGUAGE:"tangled_language",VERSION:"tangled_storage_version"},we=2,pt=[{fromVersion:0,toVersion:1,migrate:()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){const n={[localStorage.getItem(h.LANGUAGE)||"en"]:t};localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(n))}}}catch{localStorage.removeItem(h.SOLVED_PUZZLES)}}},{fromVersion:1,toVersion:2,migrate:()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(t&&typeof t=="object"&&!Array.isArray(t)){const o={};for(const[n,r]of Object.entries(t))if(Array.isArray(r)){o[n]={};for(const s of r)o[n][String(s)]="unknown"}else typeof r=="object"&&(o[n]=r);localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(o))}}}catch{localStorage.removeItem(h.SOLVED_PUZZLES)}}}],ht=()=>{const e=localStorage.getItem(h.VERSION);return e?parseInt(e,10):0},Ee=e=>{localStorage.setItem(h.VERSION,e.toString())},wt=()=>{let e=ht();for(;e<we;){const t=pt.find(o=>o.fromVersion===e);if(t)t.migrate(),e=t.toVersion,Ee(e);else{Ee(we);break}}},se=()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(t&&typeof t=="object"&&!Array.isArray(t))return t}}catch{}return{}},$e=e=>{const o=se()[e]||{};return new Set(Object.keys(o).map(Number))},ye=(e,t)=>{const o=se();o[e]||(o[e]={}),o[e][String(t)]||(o[e][String(t)]=gt()),localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(o))},Ue=(e,t)=>(se()[e]||{})[String(t)]||null,Et=(e,t)=>{const o=Ue(e,t);return!o||o==="unknown"?!1:ft(t,o)},Ve=()=>localStorage.getItem(h.HAS_PLAYED)==="true",Ze=()=>{localStorage.setItem(h.HAS_PLAYED,"true")},yt=()=>localStorage.getItem(h.LANGUAGE),Ct=e=>{localStorage.setItem(h.LANGUAGE,e)},ae=document.getElementById("board"),St=document.getElementById("keyboard"),bt=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const t=document.createElement("div");t.className="tries-label",t.textContent="TRIES",t.dataset.i18n="game.tries";const o=document.createElement("div");return o.className="tries-count",o.textContent="0",e.appendChild(t),e.appendChild(o),ae.appendChild(e),{container:e,count:o}},At=bt(),Lt=At.count,zt=()=>{const e=[];for(let t=0;t<g;t++){const o=[];for(let n=0;n<g;n++){const r=document.createElement("div");r.className="cell",r.style.gridRow=String(t+2),r.style.gridColumn=String(n+2),ae.appendChild(r),o.push(r)}e.push(o)}return e},F=e=>Array.from({length:g},(t,o)=>{const n=document.createElement("div");return n.className=`knowledge ${e.className}`,n.style.gridRow=e.gridRow(o),n.style.gridColumn=e.gridColumn(o),ae.appendChild(n),n}),y=zt(),vt=F({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),kt=F({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),It=F({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),Dt=F({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),Pt=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],Rt=()=>{const e=new Map;return Pt.forEach(t=>{const o=document.createElement("div");o.className="keyboard-row",t.forEach(n=>{const r=document.createElement("button");r.className="keyboard-key",r.dataset.key=n,n==="ENTER"?(r.textContent="ENTER",r.dataset.i18n="keyboard.enter",r.classList.add("wide")):n==="⌫"?(r.textContent="⌫",r.classList.add("wide")):r.textContent=n,e.set(n,r),o.appendChild(r)}),St.appendChild(o)}),e},Ge=Rt(),Mt=e=>{const t=e.scrollWidth>e.clientWidth+1||e.scrollHeight>e.clientHeight+1;e.classList.toggle("overflowing",t)},N=(e,t,o,n)=>{e.forEach((r,s)=>{r.replaceChildren(),[...t[s][o]].sort().forEach(l=>{const c=document.createElement("div");c.className=`knowledge-cell ${n}`,c.textContent=l,r.appendChild(c)}),Mt(r)})},Tt=e=>{for(let t=0;t<g;t++)for(let o=0;o<g;o++){const n=y[t][o],r=e.grid[t][o];n.className="cell",n.textContent=r.letter??"",n.classList.add(r.state)}},Nt=e=>{const{mode:t,cursor:o}=e;(t===m.Row?y[o.row]:y.map(r=>r[o.col])).forEach(r=>r.classList.add("highlight")),y[o.row][o.col].classList.add("cursor")},xt=["correct","misplaced-row","misplaced-col","absent"],Bt=e=>{const t=e.tries.row.reduce((o,n)=>o+n,0)+e.tries.col.reduce((o,n)=>o+n,0);Lt.textContent=String(t)},Ot=e=>{const{mode:t,cursor:o}=e,n=t===m.Row?o.row:o.col,r=t===m.Row?e.knowledge.row[n]:e.knowledge.col[n],s=t===m.Row?"misplaced-row":"misplaced-col",l=(t===m.Row?e.grid[o.row]:e.grid.map(c=>c[o.col])).filter(c=>c.state===d.Correct).map(c=>c.letter);Ge.forEach((c,u)=>{/^[A-Z]$/.test(u)&&(c.classList.remove(...xt),l.includes(u)&&c.classList.add("correct"),r.misplaced.has(u)?c.classList.add(s):r.absent.has(u)&&c.classList.add("absent"))})},S=e=>{Tt(e),Nt(e),N(vt,e.knowledge.row,"misplaced","misplaced-row"),N(kt,e.knowledge.row,"absent","absent"),N(It,e.knowledge.col,"misplaced","misplaced-col"),N(Dt,e.knowledge.col,"absent","absent"),Bt(e),Ot(e)},_t=400,Yt=200,$t=100,Ce=(e,t)=>{const o=t==="horizontal"?"X":"Y",n=[{transform:`translate${o}(0)`},{transform:`translate${o}(-6px)`},{transform:`translate${o}(6px)`},{transform:`translate${o}(-4px)`},{transform:`translate${o}(4px)`},{transform:`translate${o}(0)`}];e.forEach(r=>{r.animate(n,{duration:_t,easing:"ease-in-out"})})},j=(e,t=0)=>{const o=[{transform:"scale(1)",offset:0},{transform:"scale(1.2)",offset:.5},{transform:"scale(1)",offset:1}];e.animate(o,{duration:Yt,delay:t,easing:"ease-out"})},Se=e=>{e.forEach((t,o)=>{j(t,o*$t)})},Ut=e=>{e.forEach((n,r)=>{n.forEach((s,a)=>{const c=(Math.abs(r-2)+Math.abs(a-2))*80;s.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.3) translateY(-10px)"},{transform:"scale(1) translateY(0)"}],{duration:400,delay:c,easing:"ease-out"})})})},Vt=e=>{[...e.flat()].sort(()=>Math.random()-.5).forEach((n,r)=>{const s=r*40,a=1.2+Math.random()*.3;n.animate([{transform:"scale(1)",filter:"brightness(1)"},{transform:`scale(${a})`,filter:"brightness(1.5)"},{transform:"scale(1)",filter:"brightness(1)"}],{duration:300,delay:s,easing:"ease-out"})})},Zt=e=>{const t=e.length,o=[];let n=0,r=t-1,s=0,a=t-1;for(;n<=r&&s<=a;){for(let l=s;l<=a;l++)o.push({row:n,col:l});n++;for(let l=n;l<=r;l++)o.push({row:l,col:a});if(a--,n<=r){for(let l=a;l>=s;l--)o.push({row:r,col:l});r--}if(s<=a){for(let l=r;l>=n;l--)o.push({row:l,col:s});s++}}o.forEach(({row:l,col:c},u)=>{const i=e[l][c],f=u*50;i.animate([{transform:"scale(1) rotate(0deg)"},{transform:"scale(1.2) rotate(10deg)"},{transform:"scale(1) rotate(0deg)"}],{duration:300,delay:f,easing:"ease-out"})})},Gt=e=>{e.forEach((t,o)=>{t.forEach((n,r)=>{const s=(o+r)*60;n.animate([{transform:"translateY(0)"},{transform:"translateY(20px)"},{transform:"translateY(-15px)"},{transform:"translateY(10px)"},{transform:"translateY(-5px)"},{transform:"translateY(0)"}],{duration:500,delay:s,easing:"ease-out"})})})},Ft=e=>{e.flat().forEach(o=>{const n=Math.random()*300,r=2+Math.floor(Math.random()*2);o.animate([{filter:"brightness(1)",transform:"scale(1)"},{filter:"brightness(1.8)",transform:"scale(1.1)"},{filter:"brightness(1)",transform:"scale(1)"}],{duration:250,delay:n,iterations:r,easing:"ease-in-out"})})},be=[Ut,Vt,Zt,Gt,Ft],Ae=e=>{const t=Math.floor(Math.random()*be.length);be[t](e)},Fe=[{code:"en",name:"English",nativeName:"English"},{code:"fr",name:"French",nativeName:"Français"},{code:"pt",name:"Portuguese",nativeName:"Português"}];let He="en",Ke={};const L=()=>He,qe=e=>{He=e},We=async e=>{Ke=await(await fetch(`${ee}/locales/${e}.json`)).json()},je=e=>{const t=e.split(".");let o=Ke;for(const n of t)if(o&&typeof o=="object"&&n in o)o=o[n];else return;return o},M=e=>{const t=je(e);return typeof t=="string"?t:e},Je=e=>{const t=je(e);return Array.isArray(t)?t:[]},Ht=()=>{const e=navigator.language.split("-")[0],t=Fe.find(o=>o.code===e);return t?t.code:"en"};let p=null;const Kt=()=>{const e=document.getElementById("language-btn");e&&(p=document.createElement("div"),p.className="language-dropdown",p.hidden=!0,Fe.forEach(t=>{const o=document.createElement("button");o.className="language-option",o.dataset.lang=t.code,o.textContent=t.nativeName,t.code===L()&&o.classList.add("active"),o.addEventListener("click",()=>qt(t.code)),p.appendChild(o)}),e.parentElement?.appendChild(p),e.addEventListener("click",t=>{t.stopPropagation(),p&&(p.hidden=!p.hidden)}),document.addEventListener("click",()=>{p&&(p.hidden=!0)}))},Xe=()=>{document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=M(t))}),document.querySelectorAll("[data-i18n-html]").forEach(e=>{const t=e.getAttribute("data-i18n-html");t&&(e.innerHTML=M(t))}),document.querySelectorAll("[data-i18n-aria]").forEach(e=>{const t=e.getAttribute("data-i18n-aria");t&&e.setAttribute("aria-label",M(t))}),p&&p.querySelectorAll(".language-option").forEach(e=>{const t=e.dataset.lang;e.classList.toggle("active",t===L())})},qt=async e=>{if(e===L()){p&&(p.hidden=!0);return}qe(e),Ct(e),await Promise.all([We(e),it(e)]),Xe(),p&&(p.hidden=!0)},Le=()=>{document.getElementById("completion-banner")?.removeAttribute("hidden")},x=e=>e.mode===m.Row?y[e.cursor.row]:y.map(t=>t[e.cursor.col]),H=e=>{e.mode=e.mode===m.Row?m.Col:m.Row},B=(e,t)=>{const o=t==="down"||t==="right"?1:g-1;t==="up"||t==="down"?e.cursor.row=(e.cursor.row+o)%g:e.cursor.col=(e.cursor.col+o)%g},ze=e=>{const{row:t,col:o}=e.cursor;e.grid[t][o].state!==d.Correct&&(e.grid[t][o]={letter:"",state:d.Empty}),e.mode===m.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},ve=(e,t)=>{const{row:o,col:n}=e.cursor,r=e.grid[o][n];r.state!==d.Correct&&(r.letter=t.toUpperCase(),e.mode===m.Row?e.cursor.col=Math.min(g-1,e.cursor.col+1):e.cursor.row=Math.min(g-1,e.cursor.row+1))},ke=(e,t,o)=>{e.cursor.row=t,e.cursor.col=o},Wt=e=>{window.addEventListener("keydown",s=>{switch(s.key){case" ":s.preventDefault(),H(e);break;case"ArrowUp":B(e,"up");break;case"ArrowDown":B(e,"down");break;case"ArrowLeft":B(e,"left");break;case"ArrowRight":B(e,"right");break;case"Backspace":ze(e);break;case"Enter":{const a=he(e);if(a.success)if(a.puzzleComplete)ye(L(),W()),Ae(y),setTimeout(Le,500);else if(a.lineComplete){const l=x(e);Se(l)}else a.newlyCorrect.length>0&&a.newlyCorrect.forEach(({row:l,col:c})=>{j(y[l][c])});else{const l=x(e),c=e.mode===m.Row?"horizontal":"vertical";Ce(l,c)}break}default:/^[a-zA-Z]$/.test(s.key)&&ve(e,s.key)}S(e)});let t=0,o=null;const n=300;y.forEach((s,a)=>{s.forEach((l,c)=>{l.addEventListener("click",()=>{ke(e,a,c),S(e)}),l.addEventListener("dblclick",()=>{ke(e,a,c),H(e),S(e)}),l.addEventListener("touchend",u=>{const i=Date.now();o?.row===a&&o?.col===c&&i-t<n?(u.preventDefault(),H(e),S(e),t=0,o=null):(t=i,o={row:a,col:c})})})});const r=s=>{switch(s){case"⌫":ze(e);break;case"ENTER":{const a=he(e);if(a.success)if(a.puzzleComplete)ye(L(),W()),Ae(y),setTimeout(Le,500);else if(a.lineComplete){const l=x(e);Se(l)}else a.newlyCorrect.length>0&&a.newlyCorrect.forEach(({row:l,col:c})=>{j(y[l][c])});else{const l=x(e),c=e.mode===m.Row?"horizontal":"vertical";Ce(l,c)}break}default:/^[A-Z]$/.test(s)&&ve(e,s)}S(e)};Ge.forEach((s,a)=>{s.addEventListener("click",l=>{l.preventDefault(),r(a)})})},b=5,jt=120,Jt=300,Xt=80,Qt=2e3,eo=[["S","T","A","R","T"],["H","E","L","L","O"],["A","R","E","N","A"],["R","I","S","E","S"],["P","E","N","C","H"]],to=[[d.Correct,d.MisplacedRow,d.Correct,d.Absent,d.MisplacedCol],[d.MisplacedBoth,d.Correct,d.Absent,d.Correct,d.MisplacedRow],[d.Correct,d.Correct,d.Correct,d.Correct,d.Correct],[d.Absent,d.MisplacedCol,d.Correct,d.MisplacedBoth,d.Correct],[d.MisplacedRow,d.Absent,d.MisplacedCol,d.Correct,d.Correct]],oo=e=>{e.innerHTML="";const t=[];for(let o=0;o<b;o++){t[o]=[];for(let n=0;n<b;n++){const r=document.createElement("div");r.className="mini-cell",e.appendChild(r),t[o][n]=r}}return t},no=e=>{for(let t=0;t<b;t++)for(let o=0;o<b;o++)e[t][o].textContent="",e[t][o].className="mini-cell"},O=e=>new Promise(t=>setTimeout(t,e)),ro=e=>{let t=!0;const o=oo(e);return(async()=>{for(;t;){for(let r=0;r<b&&t;r++)for(let s=0;s<b&&t;s++)o[r][s].textContent=eo[r][s],await O(jt);if(!t||(await O(Jt),!t))break;for(let r=0;r<b&&t;r++)for(let s=0;s<b&&t;s++){const a=to[r][s];o[r][s].classList.add(a),await O(Xt)}if(!t||(await O(Qt),!t))break;no(o)}})(),()=>{t=!1}},le=document.getElementById("homepage"),ce=document.getElementById("game-container"),de=document.getElementById("puzzle-selector-screen"),Y=document.getElementById("play-now-btn"),so=document.getElementById("select-puzzle-btn"),ao=document.getElementById("back-to-home-btn"),lo=document.getElementById("random-puzzle-btn"),Ie=document.getElementById("mini-grid"),Qe=document.getElementById("help-modal"),ie=document.getElementById("help-btn"),co=document.getElementById("logo"),T=document.getElementById("puzzle-number"),io=document.getElementById("completion-banner"),uo=document.getElementById("play-next-btn"),_=document.getElementById("calendar-days"),K=document.getElementById("calendar-weekdays"),De=document.getElementById("calendar-month-year"),J=document.getElementById("calendar-prev"),X=document.getElementById("calendar-next");let A=null,w=C.getMonth(),E=C.getFullYear();const et=()=>{const t=new URLSearchParams(window.location.search).get("puzzle");return t&&/^\d+$/.test(t)?parseInt(t,10):null},z=()=>{le?.removeAttribute("hidden"),ce?.setAttribute("hidden",""),de?.setAttribute("hidden",""),T?.setAttribute("hidden",""),ie?.setAttribute("hidden","");const e=new URL(window.location.href);e.searchParams.delete("puzzle"),window.history.replaceState({},"",e.pathname),Ie&&!A&&(A=ro(Ie)),Eo()},mo=()=>{le?.setAttribute("hidden",""),ce?.setAttribute("hidden",""),de?.removeAttribute("hidden"),T?.setAttribute("hidden",""),ie?.removeAttribute("hidden"),A&&(A(),A=null);const e=new Date;w=e.getMonth(),E=e.getFullYear(),tt()},ue=()=>{le?.setAttribute("hidden",""),ce?.removeAttribute("hidden"),de?.setAttribute("hidden",""),ie?.removeAttribute("hidden"),A&&(A(),A=null)},go=(e,t,o)=>{const n=new Date(e,t,o),r=new Date(C.getFullYear(),C.getMonth(),C.getDate());if(n<r)return null;const s=n.getTime()-r.getTime(),a=Math.floor(s/(1e3*60*60*24));return a>=P()?null:a},fo=()=>{if(!K)return;const e=Je("calendar.weekdays");K.innerHTML="";for(const t of e){const o=document.createElement("span");o.className="calendar-weekday",o.textContent=t,K.appendChild(o)}},tt=()=>{if(!_||!De)return;const e=L(),t=Je("calendar.months");De.textContent=`${t[w]} ${E}`,fo();const o=new Date(E,w,1),r=new Date(E,w+1,0).getDate(),s=o.getDay(),a=new Date,l=a.getMonth()===w&&a.getFullYear()===E,c=a.getDate();_.innerHTML="";for(let u=0;u<s;u++){const i=document.createElement("button");i.className="calendar-day calendar-day-empty",i.disabled=!0,_.appendChild(i)}for(let u=1;u<=r;u++){const i=document.createElement("button");i.className="calendar-day",i.textContent=String(u);const f=go(E,w,u);l&&u===c&&i.classList.add("calendar-day-today"),f===null?(i.classList.add("locked"),i.disabled=!0):G(f)?(Ue(e,f)&&(Et(e,f)?i.classList.add("solved-on-day"):i.classList.add("solved-later")),i.addEventListener("click",()=>I(f))):(i.classList.add("locked"),i.disabled=!0),_.appendChild(i)}po()},po=()=>{if(!J||!X)return;const e=C.getMonth(),t=C.getFullYear(),o=E<t||E===t&&w<=e;J.disabled=o;const n=P(),r=Z(n-1),s=r.getMonth(),a=r.getFullYear(),l=E>a||E===a&&w>=s;X.disabled=l},Pe=e=>{w+=e,w>11?(w=0,E++):w<0&&(w=11,E--),tt()},ho=e=>{const t=Z(e),o=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${o}/${n}/${r}`},me=e=>{T&&(T.textContent=ho(e),T.removeAttribute("hidden"))},wo=()=>{io?.setAttribute("hidden","")},Eo=()=>{if(!Y)return;const e=V(),t=P();e<t?Y.textContent=M("homepage.playNow"):Y.textContent=M("homepage.randomPuzzle")},I=e=>{if(!G(e)){z();return}ne(e),te(v),wo();const t=new URL(window.location.href);t.searchParams.set("puzzle",String(e)),window.history.pushState({},"",t.toString()),ue(),me(e),Ve()||(Qe?.removeAttribute("hidden"),Ze()),S(v)},ge=()=>{const e=P(),t=$e(L()),o=V(),n=Math.min(o,e-1),r=[];for(let a=0;a<=n;a++)t.has(a)||r.push(a);let s;r.length>0?s=r[Math.floor(Math.random()*r.length)]:s=Math.floor(Math.random()*(n+1)),I(s)},yo=()=>{const e=V(),t=P();e<t?I(e):ge()},Co=()=>{const e=W(),t=P(),o=V(),n=$e(L()),r=Math.min(o,t-1);for(let s=e+1;s<=r;s++)if(!n.has(s)){I(s);return}for(let s=0;s<e;s++)if(!n.has(s)){I(s);return}o!==e&&o<t?I(o):ge()};window.addEventListener("popstate",()=>{const e=et();if(e!==null){if(!G(e)){z();return}ne(e),te(v),ue(),me(e),S(v)}else z()});const So=async()=>{wt();const t=yt()??Ht();qe(t),await Promise.all([We(t),_e(t),xe(t)]),Xe(),Kt(),console.log("Game data loaded");const o=et();o!==null&&G(o)?(ne(o),te(v),ue(),me(o),Ve()||(Qe?.removeAttribute("hidden"),Ze())):z(),Wt(v),S(v),Y?.addEventListener("click",yo),so?.addEventListener("click",mo),ao?.addEventListener("click",z),lo?.addEventListener("click",ge),J?.addEventListener("click",()=>Pe(-1)),X?.addEventListener("click",()=>Pe(1)),uo?.addEventListener("click",Co),co?.addEventListener("click",n=>{n.preventDefault(),z()})};So();
