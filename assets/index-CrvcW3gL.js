(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const L=document.getElementById("theme-toggle");if(!L)throw new Error("Theme toggle button not found");localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark");function B(){document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}L.addEventListener("click",B);var w=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(w||{}),a=(e=>(e.Row="row",e.Col="col",e))(a||{});const s=5,R="/tangled",h=()=>({misplaced:new Set,absent:new Set}),N=()=>({mode:a.Row,cursor:{row:0,col:0},grid:Array.from({length:s},()=>Array.from({length:s},()=>({letter:"",state:w.Empty}))),knowledge:{row:Array.from({length:s},h),col:Array.from({length:s},h)}}),k=N();let z=[],S=1;const $=()=>fetch(`${R}/puzzles.txt`).then(e=>e.text()).then(e=>{z=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(r=>r.toUpperCase().split("")))}),A=()=>z[S]??[];let v=new Set;const x=()=>fetch(`${R}/guesses.txt`).then(e=>e.text()).then(e=>{v=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),K=e=>v.has(e),M=document.getElementById("board"),O=()=>{const e=[];for(let o=0;o<s;o++){const r=[];for(let t=0;t<s;t++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(o+1),n.style.gridColumn=String(t+1),M.appendChild(n),r.push(n)}e.push(r)}return e},I=e=>Array.from({length:s},()=>{const o=document.createElement("div");return o.className=`knowledge ${e}`,M.appendChild(o),o}),m=O(),U=I("row"),G=I("col"),b=(e,o,r)=>{e.forEach((t,n)=>{t.replaceChildren();const{misplaced:c,absent:i}=o[n];[...c].sort().forEach(l=>{const d=document.createElement("div");d.className=`knowledge-cell ${r}`,d.textContent=l,t.appendChild(d)}),[...i].sort().forEach(l=>{const d=document.createElement("div");d.className="knowledge-cell absent",d.textContent=l,t.appendChild(d)})})},H=e=>{for(let o=0;o<s;o++)for(let r=0;r<s;r++){const t=m[o][r],n=e.grid[o][r];t.className="cell",t.textContent=n.letter??"",t.classList.add(n.state)}},T=e=>{const{mode:o,cursor:r}=e;(o===a.Row?m[r.row]:m.map(n=>n[r.col])).forEach(n=>n.classList.add("highlight")),m[r.row][r.col].classList.add("cursor")},f=e=>{H(e),T(e),b(U,e.knowledge.row,"misplaced-row"),b(G,e.knowledge.col,"misplaced-col")},y=(e,o,r,t)=>({row:e===a.Row?o:t,col:e===a.Row?t:r}),D=(e,o,r,t)=>{e.knowledge.row[o].misplaced.delete(t),e.knowledge.row[o].absent.delete(t),e.knowledge.col[r].misplaced.delete(t),e.knowledge.col[r].absent.delete(t)},W=(e,o,r,t)=>{const n=A(),c=n[r].includes(o.letter),i=n.some(l=>l[t]===o.letter);c&&i?(o.state=w.MisplacedBoth,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].misplaced.add(o.letter)):c?(o.state=w.MisplacedRow,e.knowledge.row[r].misplaced.add(o.letter),e.knowledge.col[t].absent.add(o.letter)):i?(o.state=w.MisplacedCol,e.knowledge.col[t].misplaced.add(o.letter),e.knowledge.row[r].absent.add(o.letter)):(o.state=w.Absent,e.knowledge.row[r].absent.add(o.letter),e.knowledge.col[t].absent.add(o.letter))},Z=e=>{const{mode:o,grid:r,cursor:t}=e,n=o===a.Row?r[t.row]:r.map(l=>l[t.col]),c=n.map(l=>l.letter).join("");if(c.length<s)return console.error(`"${c}" is not ${s} characters long!`),!1;if(!K(c))return console.error(`"${c}" is not a valid word!`),!1;const i=A();return n.forEach((l,d)=>{const{row:u,col:p}=y(o,t.row,t.col,d),P=o===a.Row?i[t.row][d]:i[d][t.col];l.letter===P&&(l.state=w.Correct),e.knowledge.col[p].misplaced.delete(l.letter),e.knowledge.row[u].misplaced.delete(l.letter)}),n.forEach((l,d)=>{if(l.state===w.Correct)return;const{row:u,col:p}=y(o,t.row,t.col,d);D(e,u,p,l.letter),W(e,l,u,p)}),!0},E=e=>{e.mode=e.mode===a.Row?a.Col:a.Row},g=(e,o)=>{const r=o==="down"||o==="right"?1:s-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+r)%s:e.cursor.col=(e.cursor.col+r)%s},j=e=>{const{row:o,col:r}=e.cursor;e.grid[o][r].state!==w.Correct&&(e.grid[o][r]={letter:"",state:w.Empty}),e.mode===a.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},q=(e,o)=>{const{row:r,col:t}=e.cursor,n=e.grid[r][t];n.state!==w.Correct&&(n.letter=o.toUpperCase(),e.mode===a.Row?e.cursor.col=Math.min(s-1,e.cursor.col+1):e.cursor.row=Math.min(s-1,e.cursor.row+1))},C=(e,o,r)=>{e.cursor.row=o,e.cursor.col=r},F=e=>{window.addEventListener("keydown",o=>{switch(o.key){case" ":o.preventDefault(),E(e);break;case"ArrowUp":g(e,"up");break;case"ArrowDown":g(e,"down");break;case"ArrowLeft":g(e,"left");break;case"ArrowRight":g(e,"right");break;case"Backspace":j(e);break;case"Enter":Z(e);break;default:/^[a-zA-Z]$/.test(o.key)&&q(e,o.key)}f(e)}),m.forEach((o,r)=>{o.forEach((t,n)=>{t.addEventListener("click",()=>{C(e,r,n),f(e)}),t.addEventListener("dblclick",()=>{C(e,r,n),E(e),f(e)})})})};Promise.all([x(),$()]).then(()=>{console.log("Game data loaded"),F(k),f(k)});
