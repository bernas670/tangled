(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();const B=document.getElementById("theme-toggle");if(!B)throw new Error("Theme toggle button not found");const C=document.getElementById("logo");if(C){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],o=e[Math.floor(Math.random()*e.length)];C.classList.add(o)}function P(){C&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle(C),o=getComputedStyle(document.documentElement),t=e.backgroundColor,r=o.getPropertyValue("--text-color").trim(),n=o.getPropertyValue("--cell-border").trim(),l=document.createElement("canvas");l.width=64,l.height=64;const c=l.getContext("2d");if(c){c.fillStyle=n,c.fillRect(0,0,64,64);const d=4;c.fillStyle=t,c.fillRect(d,d,64-d*2,64-d*2),c.fillStyle=r,c.font="bold 40px system-ui, sans-serif",c.textAlign="center",c.textBaseline="middle",c.fillText("T",32,34);let s=document.querySelector("link[rel='icon']");s||(s=document.createElement("link"),s.rel="icon",document.head.appendChild(s)),s.href=l.toDataURL("image/png")}})})}P();function X(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),P()}B.addEventListener("click",X);const _=document.getElementById("help-btn"),f=document.getElementById("help-modal"),q=f?.querySelector(".modal-close"),F=f?.querySelector(".modal-backdrop");function H(){f?.removeAttribute("hidden")}function R(){f?.setAttribute("hidden","")}_?.addEventListener("click",H);q?.addEventListener("click",R);F?.addEventListener("click",R);document.addEventListener("keydown",e=>{e.key==="Escape"&&f&&!f.hasAttribute("hidden")&&R()});var m=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(m||{}),a=(e=>(e.Row="row",e.Col="col",e))(a||{});const i=5,K="/tangled",v=()=>({misplaced:new Set,absent:new Set}),D=()=>({mode:a.Row,cursor:{row:0,col:0},grid:Array.from({length:i},()=>Array.from({length:i},()=>({letter:"",state:m.Empty}))),knowledge:{row:Array.from({length:i},v),col:Array.from({length:i},v)},tries:{row:Array.from({length:i},()=>0),col:Array.from({length:i},()=>0)}}),y=D(),W=e=>{const o=D();e.mode=o.mode,e.cursor=o.cursor,e.grid=o.grid,e.knowledge=o.knowledge,e.tries=o.tries};let L=[],O=1;const Z=()=>fetch(`${K}/puzzles.txt`).then(e=>e.text()).then(e=>{L=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(t=>t.toUpperCase().split("")))}),Y=()=>L[O]??[],G=e=>{e>=0&&e<L.length&&(O=e)};let U=new Set;const V=()=>fetch(`${K}/guesses.txt`).then(e=>e.text()).then(e=>{U=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),j=e=>U.has(e),A=document.getElementById("board"),J=document.getElementById("keyboard"),Q=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const o=document.createElement("div");o.className="tries-label",o.textContent="TRIES";const t=document.createElement("div");return t.className="tries-count",t.textContent="0",e.appendChild(o),e.appendChild(t),A.appendChild(e),t},ee=Q(),oe=()=>{const e=[];for(let o=0;o<i;o++){const t=[];for(let r=0;r<i;r++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(o+2),n.style.gridColumn=String(r+2),A.appendChild(n),t.push(n)}e.push(t)}return e},b=e=>Array.from({length:i},(o,t)=>{const r=document.createElement("div");return r.className=`knowledge ${e.className}`,r.style.gridRow=e.gridRow(t),r.style.gridColumn=e.gridColumn(t),A.appendChild(r),r}),w=oe(),te=b({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),re=b({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),ne=b({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),le=b({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),se=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],ce=()=>{const e=new Map;return se.forEach(o=>{const t=document.createElement("div");t.className="keyboard-row",o.forEach(r=>{const n=document.createElement("button");n.className="keyboard-key",n.dataset.key=r,r==="ENTER"?(n.textContent="ENTER",n.classList.add("wide")):r==="⌫"?(n.textContent="⌫",n.classList.add("wide")):n.textContent=r,e.set(r,n),t.appendChild(n)}),J.appendChild(t)}),e},$=ce(),h=(e,o,t,r)=>{e.forEach((n,l)=>{n.replaceChildren(),[...o[l][t]].sort().forEach(d=>{const s=document.createElement("div");s.className=`knowledge-cell ${r}`,s.textContent=d,n.appendChild(s)})})},de=e=>{for(let o=0;o<i;o++)for(let t=0;t<i;t++){const r=w[o][t],n=e.grid[o][t];r.className="cell",r.textContent=n.letter??"",r.classList.add(n.state)}},ae=e=>{const{mode:o,cursor:t}=e;(o===a.Row?w[t.row]:w.map(n=>n[t.col])).forEach(n=>n.classList.add("highlight")),w[t.row][t.col].classList.add("cursor")},ie=["correct","misplaced-row","misplaced-col","absent"],me=e=>{const o=e.tries.row.reduce((t,r)=>t+r,0)+e.tries.col.reduce((t,r)=>t+r,0);ee.textContent=String(o)},ue=e=>{const{mode:o,cursor:t}=e,r=o===a.Row?t.row:t.col,n=o===a.Row?e.knowledge.row[r]:e.knowledge.col[r],l=o===a.Row?"misplaced-row":"misplaced-col",d=(o===a.Row?e.grid[t.row]:e.grid.map(s=>s[t.col])).filter(s=>s.state===m.Correct).map(s=>s.letter);$.forEach((s,u)=>{/^[A-Z]$/.test(u)&&(s.classList.remove(...ie),d.includes(u)&&s.classList.add("correct"),n.misplaced.has(u)?s.classList.add(l):n.absent.has(u)&&s.classList.add("absent"))})},g=e=>{de(e),ae(e),h(te,e.knowledge.row,"misplaced","misplaced-row"),h(re,e.knowledge.row,"absent","absent"),h(ne,e.knowledge.col,"misplaced","misplaced-col"),h(le,e.knowledge.col,"absent","absent"),me(e),ue(e)},x=(e,o,t,r)=>({row:e===a.Row?o:r,col:e===a.Row?r:t}),pe=(e,o,t,r)=>{e.knowledge.row[o].misplaced.delete(r),e.knowledge.row[o].absent.delete(r),e.knowledge.col[t].misplaced.delete(r),e.knowledge.col[t].absent.delete(r)},we=(e,o,t,r)=>{const n=Y(),l=n[t].some((d,s)=>d===o.letter&&e.grid[t][s].state!==m.Correct),c=n.some((d,s)=>d[r]===o.letter&&e.grid[s][r].state!==m.Correct);l&&c?(o.state=m.MisplacedBoth,e.knowledge.row[t].misplaced.add(o.letter),e.knowledge.col[r].misplaced.add(o.letter)):l?(o.state=m.MisplacedRow,e.knowledge.row[t].misplaced.add(o.letter),e.knowledge.col[r].absent.add(o.letter)):c?(o.state=m.MisplacedCol,e.knowledge.col[r].misplaced.add(o.letter),e.knowledge.row[t].absent.add(o.letter)):(o.state=m.Absent,e.knowledge.row[t].absent.add(o.letter),e.knowledge.col[r].absent.add(o.letter))},z=e=>{const{mode:o,grid:t,cursor:r}=e,n=o===a.Row?t[r.row]:t.map(d=>d[r.col]),l=n.map(d=>d.letter).join("");if(l.length<i)return{success:!1,error:"incomplete"};if(!j(l))return{success:!1,error:"invalid"};const c=Y();return n.forEach((d,s)=>{const{row:u,col:p}=x(o,r.row,r.col,s),S=o===a.Row?c[r.row][s]:c[s][r.col];d.letter===S&&(d.state=m.Correct),e.knowledge.col[p].misplaced.delete(d.letter),e.knowledge.row[u].misplaced.delete(d.letter)}),n.forEach((d,s)=>{if(d.state===m.Correct)return;const{row:u,col:p}=x(o,r.row,r.col,s);pe(e,u,p,d.letter),we(e,d,u,p)}),o===a.Row?e.tries.row[r.row]++:e.tries.col[r.col]++,{success:!0}},ge=e=>e.mode===a.Row?w[e.cursor.row]:w.map(o=>o[e.cursor.col]),N=e=>{const o=ge(e),r=e.mode===a.Row?[{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(-4px)"},{transform:"translateX(4px)"},{transform:"translateX(0)"}]:[{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(6px)"},{transform:"translateY(-4px)"},{transform:"translateY(4px)"},{transform:"translateY(0)"}];o.forEach(n=>{n.animate(r,{duration:400,easing:"ease-in-out"})})},k=e=>{e.mode=e.mode===a.Row?a.Col:a.Row},E=(e,o)=>{const t=o==="down"||o==="right"?1:i-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+t)%i:e.cursor.col=(e.cursor.col+t)%i},I=e=>{const{row:o,col:t}=e.cursor;e.grid[o][t].state!==m.Correct&&(e.grid[o][t]={letter:"",state:m.Empty}),e.mode===a.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},M=(e,o)=>{const{row:t,col:r}=e.cursor,n=e.grid[t][r];n.state!==m.Correct&&(n.letter=o.toUpperCase(),e.mode===a.Row?e.cursor.col=Math.min(i-1,e.cursor.col+1):e.cursor.row=Math.min(i-1,e.cursor.row+1))},T=(e,o,t)=>{e.cursor.row=o,e.cursor.col=t},fe=e=>{window.addEventListener("keydown",l=>{switch(l.key){case" ":l.preventDefault(),k(e);break;case"ArrowUp":E(e,"up");break;case"ArrowDown":E(e,"down");break;case"ArrowLeft":E(e,"left");break;case"ArrowRight":E(e,"right");break;case"Backspace":I(e);break;case"Enter":{z(e).success||N(e);break}default:/^[a-zA-Z]$/.test(l.key)&&M(e,l.key)}g(e)});let o=0,t=null;const r=300;w.forEach((l,c)=>{l.forEach((d,s)=>{d.addEventListener("click",()=>{T(e,c,s),g(e)}),d.addEventListener("dblclick",()=>{T(e,c,s),k(e),g(e)}),d.addEventListener("touchend",u=>{const p=Date.now();t?.row===c&&t?.col===s&&p-o<r?(u.preventDefault(),k(e),g(e),o=0,t=null):(o=p,t={row:c,col:s})})})});const n=l=>{switch(l){case"⌫":I(e);break;case"ENTER":{z(e).success||N(e);break}default:/^[A-Z]$/.test(l)&&M(e,l)}g(e)};$.forEach((l,c)=>{l.addEventListener("click",d=>{d.preventDefault(),n(c)})})},he=()=>{const o=new URLSearchParams(window.location.search).get("puzzle");return o&&/^\d+$/.test(o)?parseInt(o,10):null};Promise.all([V(),Z()]).then(()=>{console.log("Game data loaded");const e=he();e!==null&&(G(e),W(y)),fe(y),g(y)});
