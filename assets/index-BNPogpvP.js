(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const Q=document.getElementById("theme-toggle");if(!Q)throw new Error("Theme toggle button not found");const k=document.getElementById("logo"),he={correct:"--cell-correct","misplaced-both":"--cell-misplaced-both","misplaced-row":"--cell-misplaced-row","misplaced-col":"--cell-misplaced-col"};if(k){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],t=e[Math.floor(Math.random()*e.length)];k.classList.add(t);const o=he[t];document.documentElement.style.setProperty("--primary-color",`var(${o})`)}function ee(){k&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle(k),t=getComputedStyle(document.documentElement),o=e.backgroundColor,r=t.getPropertyValue("--text-color").trim(),n=t.getPropertyValue("--cell-border").trim(),s=document.createElement("canvas");s.width=64,s.height=64;const l=s.getContext("2d");if(l){l.fillStyle=n,l.fillRect(0,0,64,64);const c=4;l.fillStyle=o,l.fillRect(c,c,64-c*2,64-c*2),l.fillStyle=r,l.font="bold 40px system-ui, sans-serif",l.textAlign="center",l.textBaseline="middle",l.fillText("T",32,34);let a=document.querySelector("link[rel='icon']");a||(a=document.createElement("link"),a.rel="icon",document.head.appendChild(a)),a.href=s.toDataURL("image/png")}})})}ee();function we(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),ee()}Q.addEventListener("click",we);const Ee=document.getElementById("help-btn"),E=document.getElementById("help-modal"),Ce=E?.querySelector(".modal-close"),be=E?.querySelector(".modal-backdrop");function ye(){E?.removeAttribute("hidden")}function N(){E?.setAttribute("hidden","")}Ee?.addEventListener("click",ye);Ce?.addEventListener("click",N);be?.addEventListener("click",N);document.addEventListener("keydown",e=>{e.key==="Escape"&&E&&!E.hasAttribute("hidden")&&N()});var m=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(m||{}),i=(e=>(e.Row="row",e.Col="col",e))(i||{});const u=5,te="/tangled",K=()=>({misplaced:new Set,absent:new Set}),oe=()=>({mode:i.Row,cursor:{row:0,col:0},grid:Array.from({length:u},()=>Array.from({length:u},()=>({letter:"",state:m.Empty}))),knowledge:{row:Array.from({length:u},K),col:Array.from({length:u},K)},tries:{row:Array.from({length:u},()=>0),col:Array.from({length:u},()=>0)}}),w=oe(),B=e=>{const t=oe();e.mode=t.mode,e.cursor=t.cursor,e.grid=t.grid,e.knowledge=t.knowledge,e.tries=t.tries};let L=[],T=1;const ze=()=>fetch(`${te}/puzzles.txt`).then(e=>e.text()).then(e=>{L=e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map(t=>t.split(/\s+/).map(o=>o.toUpperCase().split("")))}),re=()=>L[T]??[],D=e=>{e>=0&&e<L.length&&(T=e)},U=()=>T,ne=()=>L.length;let se=new Set;const Se=()=>fetch(`${te}/guesses.txt`).then(e=>e.text()).then(e=>{se=new Set(e.split(`
`).map(t=>t.trim().toUpperCase()))}),Ae=e=>se.has(e),O=document.getElementById("board"),ke=document.getElementById("keyboard"),Le=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const t=document.createElement("div");t.className="tries-label",t.textContent="TRIES";const o=document.createElement("div");return o.className="tries-count",o.textContent="0",e.appendChild(t),e.appendChild(o),O.appendChild(e),o},ve=Le(),Re=()=>{const e=[];for(let t=0;t<u;t++){const o=[];for(let r=0;r<u;r++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(t+2),n.style.gridColumn=String(r+2),O.appendChild(n),o.push(n)}e.push(o)}return e},v=e=>Array.from({length:u},(t,o)=>{const r=document.createElement("div");return r.className=`knowledge ${e.className}`,r.style.gridRow=e.gridRow(o),r.style.gridColumn=e.gridColumn(o),O.appendChild(r),r}),p=Re(),Pe=v({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),Ie=v({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),xe=v({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),Me=v({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),Ne=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],Be=()=>{const e=new Map;return Ne.forEach(t=>{const o=document.createElement("div");o.className="keyboard-row",t.forEach(r=>{const n=document.createElement("button");n.className="keyboard-key",n.dataset.key=r,r==="ENTER"?(n.textContent="ENTER",n.classList.add("wide")):r==="⌫"?(n.textContent="⌫",n.classList.add("wide")):n.textContent=r,e.set(r,n),o.appendChild(n)}),ke.appendChild(o)}),e},le=Be(),y=(e,t,o,r)=>{e.forEach((n,s)=>{n.replaceChildren(),[...t[s][o]].sort().forEach(c=>{const a=document.createElement("div");a.className=`knowledge-cell ${r}`,a.textContent=c,n.appendChild(a)})})},Te=e=>{for(let t=0;t<u;t++)for(let o=0;o<u;o++){const r=p[t][o],n=e.grid[t][o];r.className="cell",r.textContent=n.letter??"",r.classList.add(n.state)}},De=e=>{const{mode:t,cursor:o}=e;(t===i.Row?p[o.row]:p.map(n=>n[o.col])).forEach(n=>n.classList.add("highlight")),p[o.row][o.col].classList.add("cursor")},Oe=["correct","misplaced-row","misplaced-col","absent"],_e=e=>{const t=e.tries.row.reduce((o,r)=>o+r,0)+e.tries.col.reduce((o,r)=>o+r,0);ve.textContent=String(t)},$e=e=>{const{mode:t,cursor:o}=e,r=t===i.Row?o.row:o.col,n=t===i.Row?e.knowledge.row[r]:e.knowledge.col[r],s=t===i.Row?"misplaced-row":"misplaced-col",c=(t===i.Row?e.grid[o.row]:e.grid.map(a=>a[o.col])).filter(a=>a.state===m.Correct).map(a=>a.letter);le.forEach((a,f)=>{/^[A-Z]$/.test(f)&&(a.classList.remove(...Oe),c.includes(f)&&a.classList.add("correct"),n.misplaced.has(f)?a.classList.add(s):n.absent.has(f)&&a.classList.add("absent"))})},h=e=>{Te(e),De(e),y(Pe,e.knowledge.row,"misplaced","misplaced-row"),y(Ie,e.knowledge.row,"absent","absent"),y(xe,e.knowledge.col,"misplaced","misplaced-col"),y(Me,e.knowledge.col,"absent","absent"),_e(e),$e(e)},H=(e,t,o,r)=>({row:e===i.Row?t:r,col:e===i.Row?r:o}),Ye=(e,t,o,r)=>{e.knowledge.row[t].misplaced.delete(r),e.knowledge.row[t].absent.delete(r),e.knowledge.col[o].misplaced.delete(r),e.knowledge.col[o].absent.delete(r)},Ke=(e,t,o,r)=>{const n=re(),s=n[o].some((c,a)=>c===t.letter&&e.grid[o][a].state!==m.Correct),l=n.some((c,a)=>c[r]===t.letter&&e.grid[a][r].state!==m.Correct);s&&l?(t.state=m.MisplacedBoth,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[r].misplaced.add(t.letter)):s?(t.state=m.MisplacedRow,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[r].absent.add(t.letter)):l?(t.state=m.MisplacedCol,e.knowledge.col[r].misplaced.add(t.letter),e.knowledge.row[o].absent.add(t.letter)):(t.state=m.Absent,e.knowledge.row[o].absent.add(t.letter),e.knowledge.col[r].absent.add(t.letter))},Z=e=>{const{mode:t,grid:o,cursor:r}=e,n=t===i.Row?o[r.row]:o.map(d=>d[r.col]),s=n.map(d=>d.letter).join("");if(s.length<u)return{success:!1,error:"incomplete"};if(!Ae(s))return{success:!1,error:"invalid"};const l=re(),c=[];n.forEach((d,g)=>{const{row:C,col:b}=H(t,r.row,r.col,g),fe=t===i.Row?l[r.row][g]:l[g][r.col],ge=d.state===m.Correct;d.letter===fe&&(d.state=m.Correct,ge||c.push({row:C,col:b})),e.knowledge.col[b].misplaced.delete(d.letter),e.knowledge.row[C].misplaced.delete(d.letter)}),n.forEach((d,g)=>{if(d.state===m.Correct)return;const{row:C,col:b}=H(t,r.row,r.col,g);Ye(e,C,b,d.letter),Ke(e,d,C,b)}),t===i.Row?e.tries.row[r.row]++:e.tries.col[r.col]++;const a=n.every(d=>d.state===m.Correct),f=o.every(d=>d.every(g=>g.state===m.Correct));return{success:!0,newlyCorrect:c,lineComplete:a,puzzleComplete:f}},Ue=400,He=200,Ze=100,G=(e,t)=>{const o=t==="horizontal"?"X":"Y",r=[{transform:`translate${o}(0)`},{transform:`translate${o}(-6px)`},{transform:`translate${o}(6px)`},{transform:`translate${o}(-4px)`},{transform:`translate${o}(4px)`},{transform:`translate${o}(0)`}];e.forEach(n=>{n.animate(r,{duration:Ue,easing:"ease-in-out"})})},x=(e,t=0)=>{const o=[{transform:"scale(1)",offset:0},{transform:"scale(1.2)",offset:.5},{transform:"scale(1)",offset:1}];e.animate(o,{duration:He,delay:t,easing:"ease-out"})},V=e=>{e.forEach((t,o)=>{x(t,o*Ze)})},Ge=e=>{e.forEach((r,n)=>{r.forEach((s,l)=>{const a=(Math.abs(n-2)+Math.abs(l-2))*80;s.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.3) translateY(-10px)"},{transform:"scale(1) translateY(0)"}],{duration:400,delay:a,easing:"ease-out"})})})},Ve=e=>{[...e.flat()].sort(()=>Math.random()-.5).forEach((r,n)=>{const s=n*40,l=1.2+Math.random()*.3;r.animate([{transform:"scale(1)",filter:"brightness(1)"},{transform:`scale(${l})`,filter:"brightness(1.5)"},{transform:"scale(1)",filter:"brightness(1)"}],{duration:300,delay:s,easing:"ease-out"})})},qe=e=>{const t=e.length,o=[];let r=0,n=t-1,s=0,l=t-1;for(;r<=n&&s<=l;){for(let c=s;c<=l;c++)o.push({row:r,col:c});r++;for(let c=r;c<=n;c++)o.push({row:c,col:l});if(l--,r<=n){for(let c=l;c>=s;c--)o.push({row:n,col:c});n--}if(s<=l){for(let c=n;c>=r;c--)o.push({row:c,col:s});s++}}o.forEach(({row:c,col:a},f)=>{const d=e[c][a],g=f*50;d.animate([{transform:"scale(1) rotate(0deg)"},{transform:"scale(1.2) rotate(10deg)"},{transform:"scale(1) rotate(0deg)"}],{duration:300,delay:g,easing:"ease-out"})})},Fe=e=>{e.forEach((t,o)=>{t.forEach((r,n)=>{const s=(o+n)*60;r.animate([{transform:"translateY(0)"},{transform:"translateY(20px)"},{transform:"translateY(-15px)"},{transform:"translateY(10px)"},{transform:"translateY(-5px)"},{transform:"translateY(0)"}],{duration:500,delay:s,easing:"ease-out"})})})},We=e=>{e.flat().forEach(o=>{const r=Math.random()*300,n=2+Math.floor(Math.random()*2);o.animate([{filter:"brightness(1)",transform:"scale(1)"},{filter:"brightness(1.8)",transform:"scale(1.1)"},{filter:"brightness(1)",transform:"scale(1)"}],{duration:250,delay:r,iterations:n,easing:"ease-in-out"})})},q=[Ge,Ve,qe,Fe,We],F=e=>{const t=Math.floor(Math.random()*q.length);q[t](e)},R={SOLVED_PUZZLES:"tangled_solved_puzzles",HAS_PLAYED:"tangled_has_played"},_=()=>{try{const e=localStorage.getItem(R.SOLVED_PUZZLES);if(e)return new Set(JSON.parse(e))}catch{}return new Set},W=e=>{const t=_();t.add(e),localStorage.setItem(R.SOLVED_PUZZLES,JSON.stringify([...t]))},ce=()=>localStorage.getItem(R.HAS_PLAYED)==="true",ae=()=>{localStorage.setItem(R.HAS_PLAYED,"true")},z=e=>e.mode===i.Row?p[e.cursor.row]:p.map(t=>t[e.cursor.col]),P=e=>{e.mode=e.mode===i.Row?i.Col:i.Row},S=(e,t)=>{const o=t==="down"||t==="right"?1:u-1;t==="up"||t==="down"?e.cursor.row=(e.cursor.row+o)%u:e.cursor.col=(e.cursor.col+o)%u},J=e=>{const{row:t,col:o}=e.cursor;e.grid[t][o].state!==m.Correct&&(e.grid[t][o]={letter:"",state:m.Empty}),e.mode===i.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},X=(e,t)=>{const{row:o,col:r}=e.cursor,n=e.grid[o][r];n.state!==m.Correct&&(n.letter=t.toUpperCase(),e.mode===i.Row?e.cursor.col=Math.min(u-1,e.cursor.col+1):e.cursor.row=Math.min(u-1,e.cursor.row+1))},j=(e,t,o)=>{e.cursor.row=t,e.cursor.col=o},Je=e=>{window.addEventListener("keydown",s=>{switch(s.key){case" ":s.preventDefault(),P(e);break;case"ArrowUp":S(e,"up");break;case"ArrowDown":S(e,"down");break;case"ArrowLeft":S(e,"left");break;case"ArrowRight":S(e,"right");break;case"Backspace":J(e);break;case"Enter":{const l=Z(e);if(l.success)if(l.puzzleComplete)W(U()),F(p);else if(l.lineComplete){const c=z(e);V(c)}else l.newlyCorrect.length>0&&l.newlyCorrect.forEach(({row:c,col:a})=>{x(p[c][a])});else{const c=z(e),a=e.mode===i.Row?"horizontal":"vertical";G(c,a)}break}default:/^[a-zA-Z]$/.test(s.key)&&X(e,s.key)}h(e)});let t=0,o=null;const r=300;p.forEach((s,l)=>{s.forEach((c,a)=>{c.addEventListener("click",()=>{j(e,l,a),h(e)}),c.addEventListener("dblclick",()=>{j(e,l,a),P(e),h(e)}),c.addEventListener("touchend",f=>{const d=Date.now();o?.row===l&&o?.col===a&&d-t<r?(f.preventDefault(),P(e),h(e),t=0,o=null):(t=d,o={row:l,col:a})})})});const n=s=>{switch(s){case"⌫":J(e);break;case"ENTER":{const l=Z(e);if(l.success)if(l.puzzleComplete)W(U()),F(p);else if(l.lineComplete){const c=z(e);V(c)}else l.newlyCorrect.length>0&&l.newlyCorrect.forEach(({row:c,col:a})=>{x(p[c][a])});else{const c=z(e),a=e.mode===i.Row?"horizontal":"vertical";G(c,a)}break}default:/^[A-Z]$/.test(s)&&X(e,s)}h(e)};le.forEach((s,l)=>{s.addEventListener("click",c=>{c.preventDefault(),n(l)})})},de=document.getElementById("homepage"),ie=document.getElementById("game-container"),Xe=document.getElementById("play-now-btn"),I=document.getElementById("puzzle-grid"),me=document.getElementById("help-modal"),je=document.getElementById("logo"),A=document.getElementById("puzzle-number"),ue=()=>{const t=new URLSearchParams(window.location.search).get("puzzle");return t&&/^\d+$/.test(t)?parseInt(t,10):null},M=()=>{de?.removeAttribute("hidden"),ie?.setAttribute("hidden",""),A?.setAttribute("hidden","");const e=new URL(window.location.href);e.searchParams.delete("puzzle"),window.history.replaceState({},"",e.pathname),Qe()},$=()=>{de?.setAttribute("hidden",""),ie?.removeAttribute("hidden")},Qe=()=>{if(!I)return;const e=ne(),t=_();I.innerHTML="";for(let o=0;o<e;o++){const r=document.createElement("button");r.className="puzzle-item",t.has(o)&&r.classList.add("solved"),r.textContent=`#${String(o+1).padStart(3,"0")}`,r.addEventListener("click",()=>pe(o)),I.appendChild(r)}},Y=e=>{A&&(A.textContent=`#${String(e+1).padStart(3,"0")}`,A.removeAttribute("hidden"))},pe=e=>{D(e),B(w);const t=new URL(window.location.href);t.searchParams.set("puzzle",String(e)),window.history.pushState({},"",t.toString()),$(),Y(e),ce()||(me?.removeAttribute("hidden"),ae()),h(w)},et=()=>{const e=ne(),t=_(),o=[];for(let n=0;n<e;n++)t.has(n)||o.push(n);let r;o.length>0?r=o[Math.floor(Math.random()*o.length)]:r=Math.floor(Math.random()*e),pe(r)};window.addEventListener("popstate",()=>{const e=ue();e!==null?(D(e),B(w),$(),Y(e),h(w)):M()});Promise.all([Se(),ze()]).then(()=>{console.log("Game data loaded");const e=ue();e!==null?(D(e),B(w),$(),Y(e),ce()||(me?.removeAttribute("hidden"),ae())):M(),Je(w),h(w),Xe?.addEventListener("click",et),je?.addEventListener("click",t=>{t.preventDefault(),M()})});
