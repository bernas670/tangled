(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}})();const b=document.getElementById("theme-toggle");if(!b)throw new Error("Theme toggle button not found");localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark");function I(){document.body.classList.toggle("dark"),localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light")}b.addEventListener("click",I);var w=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(w||{}),a=(e=>(e.Row="row",e.Col="col",e))(a||{});const s=5,E="/tangled",f=()=>({misplaced:new Set,absent:new Set}),P=()=>({mode:a.Row,cursor:{row:0,col:0},grid:Array.from({length:s},()=>Array.from({length:s},()=>({letter:"",state:w.Empty}))),knowledge:{row:Array.from({length:s},f),col:Array.from({length:s},f)}}),h=P();let C=[],B=0;const N=()=>fetch(`${E}/puzzles.txt`).then(e=>e.text()).then(e=>{C=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0).map(o=>o.split(/\s+/).map(t=>t.toUpperCase().split("")))}),L=()=>C[B]??[];let R=new Set;const S=()=>fetch(`${E}/guesses.txt`).then(e=>e.text()).then(e=>{R=new Set(e.split(`
`).map(o=>o.trim().toUpperCase()))}),$=e=>R.has(e),z=document.getElementById("board"),x=()=>{const e=[];for(let o=0;o<s;o++){const t=[];for(let r=0;r<s;r++){const n=document.createElement("div");n.className="cell",n.style.gridRow=String(o+1),n.style.gridColumn=String(r+1),z.appendChild(n),t.push(n)}e.push(t)}return e},A=e=>Array.from({length:s},()=>{const o=document.createElement("div");return o.className=`knowledge ${e}`,z.appendChild(o),o}),g=x(),K=A("row"),O=A("col"),k=(e,o,t)=>{e.forEach((r,n)=>{r.replaceChildren();const{misplaced:c,absent:i}=o[n];[...c].sort().forEach(l=>{const d=document.createElement("div");d.className=`knowledge-cell ${t}`,d.textContent=l,r.appendChild(d)}),[...i].sort().forEach(l=>{const d=document.createElement("div");d.className="knowledge-cell absent",d.textContent=l,r.appendChild(d)})})},U=e=>{for(let o=0;o<s;o++)for(let t=0;t<s;t++){const r=g[o][t],n=e.grid[o][t];r.className="cell",r.textContent=n.letter??"",r.classList.add(n.state)}},G=e=>{const{mode:o,cursor:t}=e;(o===a.Row?g[t.row]:g.map(n=>n[t.col])).forEach(n=>n.classList.add("highlight")),g[t.row][t.col].classList.add("cursor")},M=e=>{U(e),G(e),k(K,e.knowledge.row,"misplaced-row"),k(O,e.knowledge.col,"misplaced-col")},y=(e,o,t,r)=>({row:e===a.Row?o:r,col:e===a.Row?r:t}),H=(e,o,t,r)=>{e.knowledge.row[o].misplaced.delete(r),e.knowledge.row[o].absent.delete(r),e.knowledge.col[t].misplaced.delete(r),e.knowledge.col[t].absent.delete(r)},T=(e,o,t,r)=>{const n=L(),c=n[t].includes(o.letter),i=n.some(l=>l[r]===o.letter);c&&i?(o.state=w.MisplacedBoth,e.knowledge.row[t].misplaced.add(o.letter),e.knowledge.col[r].misplaced.add(o.letter)):c?(o.state=w.MisplacedRow,e.knowledge.row[t].misplaced.add(o.letter),e.knowledge.col[r].absent.add(o.letter)):i?(o.state=w.MisplacedCol,e.knowledge.col[r].misplaced.add(o.letter),e.knowledge.row[t].absent.add(o.letter)):(o.state=w.Absent,e.knowledge.row[t].absent.add(o.letter),e.knowledge.col[r].absent.add(o.letter))},D=e=>{const{mode:o,grid:t,cursor:r}=e,n=o===a.Row?t[r.row]:t.map(l=>l[r.col]),c=n.map(l=>l.letter).join("");if(c.length<s)return console.error(`"${c}" is not ${s} characters long!`),!1;if(!$(c))return console.error(`"${c}" is not a valid word!`),!1;const i=L();return n.forEach((l,d)=>{const{row:m,col:u}=y(o,r.row,r.col,d),v=o===a.Row?i[r.row][d]:i[d][r.col];l.letter===v&&(l.state=w.Correct),e.knowledge.col[u].misplaced.delete(l.letter),e.knowledge.row[m].misplaced.delete(l.letter)}),n.forEach((l,d)=>{if(l.state===w.Correct)return;const{row:m,col:u}=y(o,r.row,r.col,d);H(e,m,u,l.letter),T(e,l,m,u)}),!0},W=e=>{e.mode=e.mode===a.Row?a.Col:a.Row},p=(e,o)=>{const t=o==="down"||o==="right"?1:s-1;o==="up"||o==="down"?e.cursor.row=(e.cursor.row+t)%s:e.cursor.col=(e.cursor.col+t)%s},Z=e=>{const{row:o,col:t}=e.cursor;e.grid[o][t].state!==w.Correct&&(e.grid[o][t]={letter:"",state:w.Empty}),e.mode===a.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},j=(e,o)=>{const{row:t,col:r}=e.cursor,n=e.grid[t][r];n.state!==w.Correct&&(n.letter=o.toUpperCase(),e.mode===a.Row?e.cursor.col=Math.min(s-1,e.cursor.col+1):e.cursor.row=Math.min(s-1,e.cursor.row+1))},q=e=>{window.addEventListener("keydown",o=>{switch(o.key){case" ":o.preventDefault(),W(e);break;case"ArrowUp":p(e,"up");break;case"ArrowDown":p(e,"down");break;case"ArrowLeft":p(e,"left");break;case"ArrowRight":p(e,"right");break;case"Backspace":Z(e);break;case"Enter":D(e);break;default:/^[a-zA-Z]$/.test(o.key)&&j(e,o.key)}M(e)})};Promise.all([S(),N()]).then(()=>{console.log("Game data loaded"),q(h),M(h)});
