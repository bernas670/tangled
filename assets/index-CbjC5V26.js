(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Pe=document.getElementById("theme-toggle");if(!Pe)throw new Error("Theme toggle button not found");const $=document.getElementById("logo"),nt={correct:"--cell-correct","misplaced-both":"--cell-misplaced-both","misplaced-row":"--cell-misplaced-row","misplaced-col":"--cell-misplaced-col"};if($){const e=["correct","misplaced-both","misplaced-row","misplaced-col"],t=e[Math.floor(Math.random()*e.length)];$.classList.add(t);const o=nt[t];document.documentElement.style.setProperty("--primary-color",`var(${o})`)}function Re(){$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getComputedStyle($),t=getComputedStyle(document.documentElement),o=e.backgroundColor,n=t.getPropertyValue("--text-color").trim(),r=t.getPropertyValue("--cell-border").trim(),s=document.createElement("canvas");s.width=64,s.height=64;const a=s.getContext("2d");if(a){a.fillStyle=r,a.fillRect(0,0,64,64);const l=4;a.fillStyle=o,a.fillRect(l,l,64-l*2,64-l*2),a.fillStyle=n,a.font="bold 40px system-ui, sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText("T",32,34);let c=document.querySelector("link[rel='icon']");c||(c=document.createElement("link"),c.rel="icon",document.head.appendChild(c)),c.href=s.toDataURL("image/png")}})})}Re();function rt(){document.documentElement.classList.toggle("dark"),localStorage.setItem("theme",document.documentElement.classList.contains("dark")?"dark":"light"),Re()}Pe.addEventListener("click",rt);const st=document.getElementById("help-btn"),D=document.getElementById("help-modal"),at=D?.querySelector(".modal-close"),lt=D?.querySelector(".modal-backdrop");function Me(){D?.removeAttribute("hidden")}function X(){D?.setAttribute("hidden","")}st?.addEventListener("click",Me);at?.addEventListener("click",X);lt?.addEventListener("click",X);document.addEventListener("keydown",e=>{e.key==="Escape"&&D&&(D.hasAttribute("hidden")?Me():X())});var d=(e=>(e.Empty="empty",e.Correct="correct",e.MisplacedBoth="misplaced-both",e.MisplacedRow="misplaced-row",e.MisplacedCol="misplaced-col",e.Absent="absent",e))(d||{}),u=(e=>(e.Row="row",e.Col="col",e))(u||{});const g=5,Q="/tangled",ge=()=>({misplaced:new Set,absent:new Set}),Te=()=>({mode:u.Row,cursor:{row:0,col:0},grid:Array.from({length:g},()=>Array.from({length:g},()=>({letter:"",state:d.Empty}))),knowledge:{row:Array.from({length:g},ge),col:Array.from({length:g},ge)},tries:{row:Array.from({length:g},()=>0),col:Array.from({length:g},()=>0)},completed:!1}),v=Te(),ee=e=>{const t=Te();e.mode=t.mode,e.cursor=t.cursor,e.grid=t.grid,e.knowledge=t.knowledge,e.tries=t.tries,e.completed=t.completed},Ne=[{code:"en",name:"English",nativeName:"English"},{code:"fr",name:"French",nativeName:"Français"},{code:"pt",name:"Portuguese",nativeName:"Português"}];let xe="en",Be={};const C=()=>xe,Oe=e=>{xe=e},_e=async e=>{Be=await(await fetch(`${Q}/locales/${e}.json`)).json()},Ye=e=>{const t=e.split(".");let o=Be;for(const n of t)if(o&&typeof o=="object"&&n in o)o=o[n];else return;return o},M=e=>{const t=Ye(e);return typeof t=="string"?t:e},$e=e=>{const t=Ye(e);return Array.isArray(t)?t:[]},ct=()=>{const e=navigator.language.split("-")[0],t=Ne.find(o=>o.code===e);return t?t.code:"en"};let U=[],te=1;const Ue=e=>{const t=e??C();return fetch(`${Q}/puzzles/${t}.txt`).then(o=>o.text()).then(o=>{U=o.split(`
`).map(n=>n.trim()).filter(n=>n.length>0).map(n=>n.split(/\s+/).map(r=>r.toUpperCase().split("")))})},Ve=()=>U[te]??[],oe=e=>{e>=0&&e<U.length&&(te=e)},q=()=>te,P=()=>U.length;let Ze=new Set;const Ge=e=>{const t=e??C();return fetch(`${Q}/words/${t}.txt`).then(o=>o.text()).then(o=>{Ze=new Set(o.split(`
`).map(n=>n.trim().toUpperCase()))})},dt=e=>Ze.has(e),it=e=>Promise.all([Ue(e),Ge(e)]).then(()=>{}),ne=document.getElementById("board"),mt=document.getElementById("keyboard"),ut=()=>{const e=document.createElement("div");e.className="tries-container",e.style.gridRow="1",e.style.gridColumn="1";const t=document.createElement("div");t.className="tries-label",t.textContent="TRIES",t.dataset.i18n="game.tries";const o=document.createElement("div");return o.className="tries-count",o.textContent="0",e.appendChild(t),e.appendChild(o),ne.appendChild(e),{container:e,count:o}},gt=ut(),ft=gt.count,pt=()=>{const e=[];for(let t=0;t<g;t++){const o=[];for(let n=0;n<g;n++){const r=document.createElement("div");r.className="cell",r.style.gridRow=String(t+2),r.style.gridColumn=String(n+2),ne.appendChild(r),o.push(r)}e.push(o)}return e},V=e=>Array.from({length:g},(t,o)=>{const n=document.createElement("div");return n.className=`knowledge ${e.className}`,n.style.gridRow=e.gridRow(o),n.style.gridColumn=e.gridColumn(o),ne.appendChild(n),n}),y=pt(),ht=V({className:"row-misplaced",gridRow:e=>String(e+2),gridColumn:()=>"1"}),wt=V({className:"row-absent",gridRow:e=>String(e+2),gridColumn:()=>"7"}),Et=V({className:"col-misplaced",gridRow:()=>"1",gridColumn:e=>String(e+2)}),yt=V({className:"col-absent",gridRow:()=>"7",gridColumn:e=>String(e+2)}),Ct=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["ENTER","Z","X","C","V","B","N","M","⌫"]],St=()=>{const e=new Map;return Ct.forEach(t=>{const o=document.createElement("div");o.className="keyboard-row",t.forEach(n=>{const r=document.createElement("button");r.className="keyboard-key",r.dataset.key=n,n==="ENTER"?(r.textContent="ENTER",r.dataset.i18n="keyboard.enter",r.classList.add("wide")):n==="⌫"?(r.textContent="⌫",r.classList.add("wide")):r.textContent=n,e.set(n,r),o.appendChild(r)}),mt.appendChild(o)}),e},Fe=St(),N=(e,t,o,n)=>{e.forEach((r,s)=>{r.replaceChildren(),[...t[s][o]].sort().forEach(l=>{const c=document.createElement("div");c.className=`knowledge-cell ${n}`,c.textContent=l,r.appendChild(c)})})},bt=e=>{for(let t=0;t<g;t++)for(let o=0;o<g;o++){const n=y[t][o],r=e.grid[t][o];n.className="cell",n.textContent=r.letter??"",n.classList.add(r.state)}},At=e=>{const{mode:t,cursor:o}=e;(t===u.Row?y[o.row]:y.map(r=>r[o.col])).forEach(r=>r.classList.add("highlight")),y[o.row][o.col].classList.add("cursor")},Lt=["correct","misplaced-row","misplaced-col","absent"],zt=e=>{const t=e.tries.row.reduce((o,n)=>o+n,0)+e.tries.col.reduce((o,n)=>o+n,0);ft.textContent=String(t)},vt=e=>{const{mode:t,cursor:o}=e,n=t===u.Row?o.row:o.col,r=t===u.Row?e.knowledge.row[n]:e.knowledge.col[n],s=t===u.Row?"misplaced-row":"misplaced-col",l=(t===u.Row?e.grid[o.row]:e.grid.map(c=>c[o.col])).filter(c=>c.state===d.Correct).map(c=>c.letter);Fe.forEach((c,m)=>{/^[A-Z]$/.test(m)&&(c.classList.remove(...Lt),l.includes(m)&&c.classList.add("correct"),r.misplaced.has(m)?c.classList.add(s):r.absent.has(m)&&c.classList.add("absent"))})},b=e=>{bt(e),At(e),N(ht,e.knowledge.row,"misplaced","misplaced-row"),N(wt,e.knowledge.row,"absent","absent"),N(Et,e.knowledge.col,"misplaced","misplaced-col"),N(yt,e.knowledge.col,"absent","absent"),zt(e),vt(e)},fe=(e,t,o,n)=>({row:e===u.Row?t:n,col:e===u.Row?n:o}),kt=(e,t,o,n)=>{e.knowledge.row[t].misplaced.delete(n),e.knowledge.row[t].absent.delete(n),e.knowledge.col[o].misplaced.delete(n),e.knowledge.col[o].absent.delete(n)},It=(e,t,o,n)=>{const r=Ve(),s=r[o].some((l,c)=>l===t.letter&&e.grid[o][c].state!==d.Correct),a=r.some((l,c)=>l[n]===t.letter&&e.grid[c][n].state!==d.Correct);s&&a?(t.state=d.MisplacedBoth,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].misplaced.add(t.letter)):s?(t.state=d.MisplacedRow,e.knowledge.row[o].misplaced.add(t.letter),e.knowledge.col[n].absent.add(t.letter)):a?(t.state=d.MisplacedCol,e.knowledge.col[n].misplaced.add(t.letter),e.knowledge.row[o].absent.add(t.letter)):(t.state=d.Absent,e.knowledge.row[o].absent.add(t.letter),e.knowledge.col[n].absent.add(t.letter))},pe=e=>{const{mode:t,grid:o,cursor:n}=e,r=t===u.Row?o[n.row]:o.map(i=>i[n.col]),s=r.map(i=>i.letter).join("");if(s.length<g)return{success:!1,error:"incomplete"};if(!dt(s))return{success:!1,error:"invalid"};const a=Ve(),l=[];r.forEach((i,f)=>{const{row:k,col:R}=fe(t,n.row,n.col,f),tt=t===u.Row?a[n.row][f]:a[f][n.col],ot=i.state===d.Correct;i.letter===tt&&(i.state=d.Correct,ot||l.push({row:k,col:R})),e.knowledge.col[R].misplaced.delete(i.letter),e.knowledge.row[k].misplaced.delete(i.letter)}),r.forEach((i,f)=>{if(i.state===d.Correct)return;const{row:k,col:R}=fe(t,n.row,n.col,f);kt(e,k,R,i.letter),It(e,i,k,R)}),e.completed||(t===u.Row?e.tries.row[n.row]++:e.tries.col[n.col]++);const c=r.every(i=>i.state===d.Correct),m=o.every(i=>i.every(f=>f.state===d.Correct));return m&&(e.completed=!0),{success:!0,newlyCorrect:l,lineComplete:c,puzzleComplete:m}},Dt=400,Pt=200,Rt=100,he=(e,t)=>{const o=t==="horizontal"?"X":"Y",n=[{transform:`translate${o}(0)`},{transform:`translate${o}(-6px)`},{transform:`translate${o}(6px)`},{transform:`translate${o}(-4px)`},{transform:`translate${o}(4px)`},{transform:`translate${o}(0)`}];e.forEach(r=>{r.animate(n,{duration:Dt,easing:"ease-in-out"})})},j=(e,t=0)=>{const o=[{transform:"scale(1)",offset:0},{transform:"scale(1.2)",offset:.5},{transform:"scale(1)",offset:1}];e.animate(o,{duration:Pt,delay:t,easing:"ease-out"})},we=e=>{e.forEach((t,o)=>{j(t,o*Rt)})},Mt=e=>{e.forEach((n,r)=>{n.forEach((s,a)=>{const c=(Math.abs(r-2)+Math.abs(a-2))*80;s.animate([{transform:"scale(1) translateY(0)"},{transform:"scale(1.3) translateY(-10px)"},{transform:"scale(1) translateY(0)"}],{duration:400,delay:c,easing:"ease-out"})})})},Tt=e=>{[...e.flat()].sort(()=>Math.random()-.5).forEach((n,r)=>{const s=r*40,a=1.2+Math.random()*.3;n.animate([{transform:"scale(1)",filter:"brightness(1)"},{transform:`scale(${a})`,filter:"brightness(1.5)"},{transform:"scale(1)",filter:"brightness(1)"}],{duration:300,delay:s,easing:"ease-out"})})},Nt=e=>{const t=e.length,o=[];let n=0,r=t-1,s=0,a=t-1;for(;n<=r&&s<=a;){for(let l=s;l<=a;l++)o.push({row:n,col:l});n++;for(let l=n;l<=r;l++)o.push({row:l,col:a});if(a--,n<=r){for(let l=a;l>=s;l--)o.push({row:r,col:l});r--}if(s<=a){for(let l=r;l>=n;l--)o.push({row:l,col:s});s++}}o.forEach(({row:l,col:c},m)=>{const i=e[l][c],f=m*50;i.animate([{transform:"scale(1) rotate(0deg)"},{transform:"scale(1.2) rotate(10deg)"},{transform:"scale(1) rotate(0deg)"}],{duration:300,delay:f,easing:"ease-out"})})},xt=e=>{e.forEach((t,o)=>{t.forEach((n,r)=>{const s=(o+r)*60;n.animate([{transform:"translateY(0)"},{transform:"translateY(20px)"},{transform:"translateY(-15px)"},{transform:"translateY(10px)"},{transform:"translateY(-5px)"},{transform:"translateY(0)"}],{duration:500,delay:s,easing:"ease-out"})})})},Bt=e=>{e.flat().forEach(o=>{const n=Math.random()*300,r=2+Math.floor(Math.random()*2);o.animate([{filter:"brightness(1)",transform:"scale(1)"},{filter:"brightness(1.8)",transform:"scale(1.1)"},{filter:"brightness(1)",transform:"scale(1)"}],{duration:250,delay:n,iterations:r,easing:"ease-in-out"})})},Ee=[Mt,Tt,Nt,xt,Bt],ye=e=>{const t=Math.floor(Math.random()*Ee.length);Ee[t](e)},S=new Date("2026-02-01T00:00:00"),re=()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())},Z=()=>{const t=re().getTime()-S.getTime(),o=Math.floor(t/(1e3*60*60*24));return Math.max(0,o)},G=e=>{const t=new Date(S);return t.setDate(t.getDate()+e),t},He=e=>{const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`},Ot=()=>He(re()),F=e=>{const t=G(e),o=re();return t.getTime()<=o.getTime()},_t=(e,t)=>{const o=He(G(e));return t===o},h={SOLVED_PUZZLES:"tangled_solved_puzzles",HAS_PLAYED:"tangled_has_played",LANGUAGE:"tangled_language",VERSION:"tangled_storage_version"},Ce=2,Yt=[{fromVersion:0,toVersion:1,migrate:()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){const n={[localStorage.getItem(h.LANGUAGE)||"en"]:t};localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(n))}}}catch{localStorage.removeItem(h.SOLVED_PUZZLES)}}},{fromVersion:1,toVersion:2,migrate:()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(t&&typeof t=="object"&&!Array.isArray(t)){const o={};for(const[n,r]of Object.entries(t))if(Array.isArray(r)){o[n]={};for(const s of r)o[n][String(s)]="unknown"}else typeof r=="object"&&(o[n]=r);localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(o))}}}catch{localStorage.removeItem(h.SOLVED_PUZZLES)}}}],$t=()=>{const e=localStorage.getItem(h.VERSION);return e?parseInt(e,10):0},Se=e=>{localStorage.setItem(h.VERSION,e.toString())},Ut=()=>{let e=$t();for(;e<Ce;){const t=Yt.find(o=>o.fromVersion===e);if(t)t.migrate(),e=t.toVersion,Se(e);else{Se(Ce);break}}},se=()=>{try{const e=localStorage.getItem(h.SOLVED_PUZZLES);if(e){const t=JSON.parse(e);if(t&&typeof t=="object"&&!Array.isArray(t))return t}}catch{}return{}},Ke=e=>{const o=se()[e]||{};return new Set(Object.keys(o).map(Number))},be=(e,t)=>{const o=se();o[e]||(o[e]={}),o[e][String(t)]||(o[e][String(t)]=Ot()),localStorage.setItem(h.SOLVED_PUZZLES,JSON.stringify(o))},qe=(e,t)=>(se()[e]||{})[String(t)]||null,Vt=(e,t)=>{const o=qe(e,t);return!o||o==="unknown"?!1:_t(t,o)},je=()=>localStorage.getItem(h.HAS_PLAYED)==="true",We=()=>{localStorage.setItem(h.HAS_PLAYED,"true")},Zt=()=>localStorage.getItem(h.LANGUAGE),Gt=e=>{localStorage.setItem(h.LANGUAGE,e)},Ae=()=>{document.getElementById("completion-banner")?.removeAttribute("hidden")},x=e=>e.mode===u.Row?y[e.cursor.row]:y.map(t=>t[e.cursor.col]),H=e=>{e.mode=e.mode===u.Row?u.Col:u.Row},B=(e,t)=>{const o=t==="down"||t==="right"?1:g-1;t==="up"||t==="down"?e.cursor.row=(e.cursor.row+o)%g:e.cursor.col=(e.cursor.col+o)%g},Le=e=>{const{row:t,col:o}=e.cursor;e.grid[t][o].state!==d.Correct&&(e.grid[t][o]={letter:"",state:d.Empty}),e.mode===u.Row?e.cursor.col=Math.max(e.cursor.col-1,0):e.cursor.row=Math.max(e.cursor.row-1,0)},ze=(e,t)=>{const{row:o,col:n}=e.cursor,r=e.grid[o][n];r.state!==d.Correct&&(r.letter=t.toUpperCase(),e.mode===u.Row?e.cursor.col=Math.min(g-1,e.cursor.col+1):e.cursor.row=Math.min(g-1,e.cursor.row+1))},ve=(e,t,o)=>{e.cursor.row=t,e.cursor.col=o},Ft=e=>{window.addEventListener("keydown",s=>{switch(s.key){case" ":s.preventDefault(),H(e);break;case"ArrowUp":B(e,"up");break;case"ArrowDown":B(e,"down");break;case"ArrowLeft":B(e,"left");break;case"ArrowRight":B(e,"right");break;case"Backspace":Le(e);break;case"Enter":{const a=pe(e);if(a.success)if(a.puzzleComplete)be(C(),q()),ye(y),setTimeout(Ae,500);else if(a.lineComplete){const l=x(e);we(l)}else a.newlyCorrect.length>0&&a.newlyCorrect.forEach(({row:l,col:c})=>{j(y[l][c])});else{const l=x(e),c=e.mode===u.Row?"horizontal":"vertical";he(l,c)}break}default:/^[a-zA-Z]$/.test(s.key)&&ze(e,s.key)}b(e)});let t=0,o=null;const n=300;y.forEach((s,a)=>{s.forEach((l,c)=>{l.addEventListener("click",()=>{ve(e,a,c),b(e)}),l.addEventListener("dblclick",()=>{ve(e,a,c),H(e),b(e)}),l.addEventListener("touchend",m=>{const i=Date.now();o?.row===a&&o?.col===c&&i-t<n?(m.preventDefault(),H(e),b(e),t=0,o=null):(t=i,o={row:a,col:c})})})});const r=s=>{switch(s){case"⌫":Le(e);break;case"ENTER":{const a=pe(e);if(a.success)if(a.puzzleComplete)be(C(),q()),ye(y),setTimeout(Ae,500);else if(a.lineComplete){const l=x(e);we(l)}else a.newlyCorrect.length>0&&a.newlyCorrect.forEach(({row:l,col:c})=>{j(y[l][c])});else{const l=x(e),c=e.mode===u.Row?"horizontal":"vertical";he(l,c)}break}default:/^[A-Z]$/.test(s)&&ze(e,s)}b(e)};Fe.forEach((s,a)=>{s.addEventListener("click",l=>{l.preventDefault(),r(a)})})},A=5,Ht=120,Kt=300,qt=80,jt=2e3,Wt=[["S","T","A","R","T"],["H","E","L","L","O"],["A","R","E","N","A"],["R","I","S","E","S"],["P","E","N","C","H"]],Jt=[[d.Correct,d.MisplacedRow,d.Correct,d.Absent,d.MisplacedCol],[d.MisplacedBoth,d.Correct,d.Absent,d.Correct,d.MisplacedRow],[d.Correct,d.Correct,d.Correct,d.Correct,d.Correct],[d.Absent,d.MisplacedCol,d.Correct,d.MisplacedBoth,d.Correct],[d.MisplacedRow,d.Absent,d.MisplacedCol,d.Correct,d.Correct]],Xt=e=>{e.innerHTML="";const t=[];for(let o=0;o<A;o++){t[o]=[];for(let n=0;n<A;n++){const r=document.createElement("div");r.className="mini-cell",e.appendChild(r),t[o][n]=r}}return t},Qt=e=>{for(let t=0;t<A;t++)for(let o=0;o<A;o++)e[t][o].textContent="",e[t][o].className="mini-cell"},O=e=>new Promise(t=>setTimeout(t,e)),eo=e=>{let t=!0;const o=Xt(e);return(async()=>{for(;t;){for(let r=0;r<A&&t;r++)for(let s=0;s<A&&t;s++)o[r][s].textContent=Wt[r][s],await O(Ht);if(!t||(await O(Kt),!t))break;for(let r=0;r<A&&t;r++)for(let s=0;s<A&&t;s++){const a=Jt[r][s];o[r][s].classList.add(a),await O(qt)}if(!t||(await O(jt),!t))break;Qt(o)}})(),()=>{t=!1}};let p=null;const to=()=>{const e=document.getElementById("language-btn");e&&(p=document.createElement("div"),p.className="language-dropdown",p.hidden=!0,Ne.forEach(t=>{const o=document.createElement("button");o.className="language-option",o.dataset.lang=t.code,o.textContent=t.nativeName,t.code===C()&&o.classList.add("active"),o.addEventListener("click",()=>oo(t.code)),p.appendChild(o)}),e.parentElement?.appendChild(p),e.addEventListener("click",t=>{t.stopPropagation(),p&&(p.hidden=!p.hidden)}),document.addEventListener("click",()=>{p&&(p.hidden=!0)}))},Je=()=>{document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=M(t))}),document.querySelectorAll("[data-i18n-html]").forEach(e=>{const t=e.getAttribute("data-i18n-html");t&&(e.innerHTML=M(t))}),document.querySelectorAll("[data-i18n-aria]").forEach(e=>{const t=e.getAttribute("data-i18n-aria");t&&e.setAttribute("aria-label",M(t))}),p&&p.querySelectorAll(".language-option").forEach(e=>{const t=e.dataset.lang;e.classList.toggle("active",t===C())})},oo=async e=>{if(e===C()){p&&(p.hidden=!0);return}Oe(e),Gt(e),await Promise.all([_e(e),it(e)]),Je(),p&&(p.hidden=!0)},ae=document.getElementById("homepage"),le=document.getElementById("game-container"),ce=document.getElementById("puzzle-selector-screen"),Y=document.getElementById("play-now-btn"),no=document.getElementById("select-puzzle-btn"),ro=document.getElementById("back-to-home-btn"),so=document.getElementById("random-puzzle-btn"),ke=document.getElementById("mini-grid"),Xe=document.getElementById("help-modal"),de=document.getElementById("help-btn"),ao=document.getElementById("logo"),T=document.getElementById("puzzle-number"),lo=document.getElementById("completion-banner"),co=document.getElementById("play-next-btn"),_=document.getElementById("calendar-days"),K=document.getElementById("calendar-weekdays"),Ie=document.getElementById("calendar-month-year"),W=document.getElementById("calendar-prev"),J=document.getElementById("calendar-next");let L=null,w=S.getMonth(),E=S.getFullYear();const Qe=()=>{const t=new URLSearchParams(window.location.search).get("puzzle");return t&&/^\d+$/.test(t)?parseInt(t,10):null},z=()=>{ae?.removeAttribute("hidden"),le?.setAttribute("hidden",""),ce?.setAttribute("hidden",""),T?.setAttribute("hidden",""),de?.setAttribute("hidden","");const e=new URL(window.location.href);e.searchParams.delete("puzzle"),window.history.replaceState({},"",e.pathname),ke&&!L&&(L=eo(ke)),ho()},io=()=>{ae?.setAttribute("hidden",""),le?.setAttribute("hidden",""),ce?.removeAttribute("hidden"),T?.setAttribute("hidden",""),de?.removeAttribute("hidden"),L&&(L(),L=null);const e=new Date;w=e.getMonth(),E=e.getFullYear(),et()},ie=()=>{ae?.setAttribute("hidden",""),le?.removeAttribute("hidden"),ce?.setAttribute("hidden",""),de?.removeAttribute("hidden"),L&&(L(),L=null)},mo=(e,t,o)=>{const n=new Date(e,t,o),r=new Date(S.getFullYear(),S.getMonth(),S.getDate());if(n<r)return null;const s=n.getTime()-r.getTime(),a=Math.floor(s/(1e3*60*60*24));return a>=P()?null:a},uo=()=>{if(!K)return;const e=$e("calendar.weekdays");K.innerHTML="";for(const t of e){const o=document.createElement("span");o.className="calendar-weekday",o.textContent=t,K.appendChild(o)}},et=()=>{if(!_||!Ie)return;const e=C(),t=$e("calendar.months");Ie.textContent=`${t[w]} ${E}`,uo();const o=new Date(E,w,1),r=new Date(E,w+1,0).getDate(),s=o.getDay(),a=new Date,l=a.getMonth()===w&&a.getFullYear()===E,c=a.getDate();_.innerHTML="";for(let m=0;m<s;m++){const i=document.createElement("button");i.className="calendar-day calendar-day-empty",i.disabled=!0,_.appendChild(i)}for(let m=1;m<=r;m++){const i=document.createElement("button");i.className="calendar-day",i.textContent=String(m);const f=mo(E,w,m);l&&m===c&&i.classList.add("calendar-day-today"),f===null?(i.classList.add("locked"),i.disabled=!0):F(f)?(qe(e,f)&&(Vt(e,f)?i.classList.add("solved-on-day"):i.classList.add("solved-later")),i.addEventListener("click",()=>I(f))):(i.classList.add("locked"),i.disabled=!0),_.appendChild(i)}go()},go=()=>{if(!W||!J)return;const e=S.getMonth(),t=S.getFullYear(),o=E<t||E===t&&w<=e;W.disabled=o;const n=P(),r=G(n-1),s=r.getMonth(),a=r.getFullYear(),l=E>a||E===a&&w>=s;J.disabled=l},De=e=>{w+=e,w>11?(w=0,E++):w<0&&(w=11,E--),et()},fo=e=>{const t=G(e),o=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${o}/${n}/${r}`},me=e=>{T&&(T.textContent=fo(e),T.removeAttribute("hidden"))},po=()=>{lo?.setAttribute("hidden","")},ho=()=>{if(!Y)return;const e=Z(),t=P();e<t?Y.textContent=M("homepage.playNow"):Y.textContent=M("homepage.randomPuzzle")},I=e=>{if(!F(e)){z();return}oe(e),ee(v),po();const t=new URL(window.location.href);t.searchParams.set("puzzle",String(e)),window.history.pushState({},"",t.toString()),ie(),me(e),je()||(Xe?.removeAttribute("hidden"),We()),b(v)},ue=()=>{const e=P(),t=Ke(C()),o=Z(),n=Math.min(o,e-1),r=[];for(let a=0;a<=n;a++)t.has(a)||r.push(a);let s;r.length>0?s=r[Math.floor(Math.random()*r.length)]:s=Math.floor(Math.random()*(n+1)),I(s)},wo=()=>{const e=Z(),t=P();e<t?I(e):ue()},Eo=()=>{const e=q(),t=P(),o=Z(),n=Ke(C()),r=Math.min(o,t-1);for(let s=e+1;s<=r;s++)if(!n.has(s)){I(s);return}for(let s=0;s<e;s++)if(!n.has(s)){I(s);return}o!==e&&o<t?I(o):ue()};window.addEventListener("popstate",()=>{const e=Qe();if(e!==null){if(!F(e)){z();return}oe(e),ee(v),ie(),me(e),b(v)}else z()});const yo=async()=>{Ut();const t=Zt()??ct();Oe(t),await Promise.all([_e(t),Ge(t),Ue(t)]),Je(),to(),console.log("Game data loaded");const o=Qe();o!==null&&F(o)?(oe(o),ee(v),ie(),me(o),je()||(Xe?.removeAttribute("hidden"),We())):z(),Ft(v),b(v),Y?.addEventListener("click",wo),no?.addEventListener("click",io),ro?.addEventListener("click",z),so?.addEventListener("click",ue),W?.addEventListener("click",()=>De(-1)),J?.addEventListener("click",()=>De(1)),co?.addEventListener("click",Eo),ao?.addEventListener("click",n=>{n.preventDefault(),z()})};yo();
